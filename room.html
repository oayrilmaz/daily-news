<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTD Today — Intelligence Room</title>
  <meta name="description" content="PTD Today — Intelligence Room." />

  <style>
    :root{
      --bg:#ffffff;
      --paper:#ffffff;
      --ink:#111111;
      --muted:#5c5c5c;
      --rule:rgba(0,0,0,.15);
      --soft:rgba(0,0,0,.06);
      --pill:rgba(0,0,0,.04);
      --btn:#111;
      --btnInk:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family: Georgia, "Times New Roman", Times, serif;
      -webkit-font-smoothing:antialiased;
    }
    .wrap{max-width:980px;margin:0 auto;padding:26px 16px 60px}
    .mast{text-align:center;padding:16px 0 6px}
    .brand{margin:0;font-size:52px;letter-spacing:.2px;font-weight:700}
    .tagline{margin:6px 0 10px;color:var(--muted);font-style:italic;font-size:16px}
    .nav{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin:10px 0 10px}
    .nav a{
      text-decoration:none;padding:7px 12px;border-radius:999px;
      border:1px solid transparent;color:rgba(0,0,0,.75);font-size:15px
    }
    .nav a:hover{border-color:var(--rule);background:rgba(0,0,0,.02)}
    .nav a.active{border-color:var(--rule);background:rgba(0,0,0,.03);font-weight:700;color:rgba(0,0,0,.92)}
    .rule{height:1px;background:var(--rule);margin:14px 0 0}

    .pageTitle{text-align:center;margin:18px 0 2px;font-size:44px;font-weight:800}
    .updated{text-align:center;color:var(--muted);font-size:15px;margin:6px 0 18px}

    .panel{background:var(--paper);border:1px solid var(--rule);border-radius:14px;overflow:hidden}
    .notice{padding:12px 14px;border-bottom:1px solid var(--rule);background:rgba(0,0,0,.02);font-size:14px;color:rgba(0,0,0,.80)}
    .formWrap{padding:14px;border-bottom:1px solid var(--rule)}
    .grid{display:grid;grid-template-columns:1fr 1fr 1fr 160px;gap:10px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr 1fr; } }
    @media (max-width:520px){ .grid{grid-template-columns:1fr; } }

    input, select, textarea{
      width:100%;
      border:1px solid var(--rule);
      border-radius:10px;
      padding:10px 12px;
      font-family:inherit;
      font-size:14px;
      background:#fff;
      outline:none;
    }
    textarea{min-height:120px;resize:vertical}

    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      appearance:none;border:1px solid var(--rule);border-radius:999px;
      padding:9px 14px;cursor:pointer;font-family:inherit;font-size:14px;
      background:var(--btn);color:var(--btnInk);
    }
    .btn.secondary{background:#fff;color:#111}
    .feedHead{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      padding:10px 14px;border-bottom:1px solid var(--rule);background:#fff;
    }
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;border:1px solid var(--rule);
      background:var(--pill);font-size:13px;color:rgba(0,0,0,.78)
    }

    .feed{padding:0}
    .post{
      padding:16px 14px;border-bottom:1px solid var(--soft);
    }
    .post:last-child{border-bottom:none}
    .meta{
      color:var(--muted);font-size:12px;letter-spacing:.14px;text-transform:uppercase;margin-bottom:6px
    }
    .pTitle{margin:0 0 8px;font-size:20px;font-weight:900;line-height:1.12}
    .pBody{margin:0;font-size:15px;line-height:1.6;color:rgba(0,0,0,.86)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{
      display:inline-flex;align-items:center;padding:6px 10px;border-radius:999px;
      border:1px solid var(--rule);background:rgba(0,0,0,.02);font-size:12px;color:rgba(0,0,0,.72)
    }

    .footer{text-align:center;margin-top:18px;color:var(--muted);font-size:13px}
  </style>
</head>

<body>
  <div class="wrap">
    <header class="mast">
      <h1 class="brand">PTD Today</h1>
      <div class="tagline">First to Know. First to Lead.</div>

      <nav class="nav" aria-label="Primary navigation">
        <a href="/index.html">Home</a>
        <a class="active" href="/room.html">Room</a>
      </nav>

      <div class="rule"></div>
    </header>

    <div class="pageTitle">PTD Intelligence Room</div>
    <div class="updated" id="updatedLine">Updated —</div>

    <section class="panel">
      <div class="notice">
        <strong>Allowed:</strong> Grid • Data Centers • Renewables • Oil &amp; Gas (infrastructure) • OEM/EPC • Careers<br/>
        <strong>Not allowed:</strong> Politics / elections / general geopolitics • hate • abuse • spam
      </div>

      <div class="formWrap">
        <div class="grid">
          <div>
            <label for="name" style="display:block;margin:0 0 6px;color:var(--muted);font-size:13px">Your name</label>
            <input id="name" placeholder="e.g., Thomas Edison" />
          </div>
          <div>
            <label for="company" style="display:block;margin:0 0 6px;color:var(--muted);font-size:13px">Company (optional)</label>
            <input id="company" placeholder="e.g., PTD Today / GE Vernova" />
          </div>
          <div>
            <label for="location" style="display:block;margin:0 0 6px;color:var(--muted);font-size:13px">Location (optional)</label>
            <input id="location" placeholder="e.g., US / NC / EU / Dubai" />
          </div>
          <div>
            <label for="category" style="display:block;margin:0 0 6px;color:var(--muted);font-size:13px">Category</label>
            <select id="category">
              <option>Job</option>
              <option>Need</option>
              <option>Offer</option>
              <option>Service</option>
              <option>Equipment</option>
              <option>RFP</option>
              <option>Other</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="message" style="display:block;margin:0 0 6px;color:var(--muted);font-size:13px">Message</label>
          <textarea id="message" placeholder="Post your need or offer (professional + clean). Example: Need GIS commissioning support in Q2; looking for recommended contractors in the U.S."></textarea>
        </div>

        <div class="btnRow">
          <button class="btn" id="btnPost" type="button">Post</button>
          <button class="btn secondary" id="btnRefresh" type="button">Refresh feed</button>
          <button class="btn secondary" id="btnClear" type="button">Clear my local feed</button>
        </div>
      </div>

      <div class="feedHead">
        <span class="pill" id="countPill">Posts: 0</span>
        <span class="pill">Local prototype (browser storage)</span>
      </div>

      <div class="feed" id="feed"></div>
    </section>

    <div class="footer">© <span id="year"></span> PTD Today</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const STORE_KEY = "ptd_room_posts_v1";

    function nowIso(){ return new Date().toISOString(); }
    function fmtLocal(iso){
      try{ return new Date(iso).toLocaleString(); }catch(e){ return iso; }
    }
    function escapeHtml(str){
      return (str ?? "").toString()
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }

    function loadPosts(){
      try{
        const raw = localStorage.getItem(STORE_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch(e){
        return [];
      }
    }
    function savePosts(posts){
      localStorage.setItem(STORE_KEY, JSON.stringify(posts, null, 2));
    }

    function render(){
      const posts = loadPosts().sort((a,b)=> (b.created_at||"").localeCompare(a.created_at||""));
      $("countPill").textContent = `Posts: ${posts.length}`;
      $("updatedLine").textContent = `Updated — ${new Date().toLocaleString()}`;

      $("feed").innerHTML = posts.length ? posts.map(p => `
        <div class="post">
          <div class="meta">
            ${escapeHtml(p.category || "Other")} • ${escapeHtml(p.location || "—")} • ${escapeHtml(fmtLocal(p.created_at))}
          </div>
          <h3 class="pTitle">${escapeHtml(p.title || "Post")}</h3>
          <p class="pBody">${escapeHtml(p.message || "")}</p>
          <div class="chips">
            ${p.company ? `<span class="chip">${escapeHtml(p.company)}</span>` : ""}
            ${p.name ? `<span class="chip">${escapeHtml(p.name)}</span>` : ""}
          </div>
        </div>
      `).join("") : `
        <div class="post">
          <div class="meta">PTD Today • PTD Today • Global</div>
          <h3 class="pTitle">Welcome to the PTD Intelligence Room</h3>
          <p class="pBody">
            This is a community space for professionals across power transmission, grid infrastructure, renewables,
            data centers, and energy to share real needs and real offers.
          </p>
          <p class="pBody" style="margin-top:10px">
            Whether you are: (1) looking for expertise/support, (2) offering services/equipment/solutions,
            (3) hiring or open to roles — post here.
          </p>
        </div>
      `;
    }

    function makeTitleFrom(category, company, location){
      const parts = [];
      if(category) parts.push(category);
      if(company) parts.push(company);
      if(location) parts.push(location);
      return parts.join(" • ").slice(0, 90) || "Post";
    }

    $("btnPost").addEventListener("click", ()=>{
      const name = $("name").value.trim();
      const company = $("company").value.trim();
      const location = $("location").value.trim();
      const category = $("category").value;
      const message = $("message").value.trim();

      if(!message){
        alert("Please enter a message.");
        return;
      }

      const posts = loadPosts();
      posts.push({
        id: "room-" + Math.random().toString(36).slice(2),
        created_at: nowIso(),
        name, company, location, category,
        title: makeTitleFrom(category, company, location),
        message
      });
      savePosts(posts);

      $("message").value = "";
      render();
    });

    $("btnRefresh").addEventListener("click", render);
    $("btnClear").addEventListener("click", ()=>{
      if(confirm("Clear your local Room feed on this browser?")){
        localStorage.removeItem(STORE_KEY);
        render();
      }
    });

    $("year").textContent = new Date().getFullYear();
    render();
  </script>
</body>
</html>