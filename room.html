<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Analytics 4 -->
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVKD1RLFE5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-TVKD1RLFE5');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#E7DCC8" />
  <meta name="color-scheme" content="light only" />
  <meta name="description" content="PTD Intelligence Room: Post professional needs (jobs, resources, equipment, labor, advice) — non-political, clean, energy-infrastructure focused." />
  <link rel="canonical" href="https://ptdtoday.com/room.html" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />

  <!-- Social -->
  <meta property="og:site_name" content="PTD Today" />
  <meta property="og:title" content="PTD Today — Intelligence Room" />
  <meta property="og:description" content="Post professional needs (jobs, resources, equipment, labor, advice) — non-political, clean, energy-infrastructure focused." />
  <meta property="og:image" content="/assets/og-default.png" />
  <meta property="og:url" content="https://ptdtoday.com/room.html" />
  <meta name="twitter:card" content="summary_large_image" />

  <title>PTD Today — Intelligence Room</title>

  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="stylesheet" href="/assets/main.css" />

  <style>
    /* Header */
    header.site-header { text-align:center; margin:34px 10px 18px; }
    header.site-header h1 { margin:0 0 6px; font-size:56px; line-height:1; letter-spacing:.2px; }
    header.site-header h1 a { color:inherit; text-decoration:none; }
    header.site-header .motto { margin:2px 0 10px; color:#6F675D; font-style:italic; font-size:18px; }

    .ptd-nav { display:flex; justify-content:center; gap:22px; margin:6px 0 16px; font-size:14px; flex-wrap:wrap; }
    .ptd-nav a { text-decoration:none; color:#222; padding:6px 10px; border-radius:999px; }
    .ptd-nav a:hover { background:#f1ece3; }
    .ptd-nav a.active { font-weight:600; background:#e7dcc8; }

    .wrap-inner{ max-width:980px; margin:0 auto; padding:0 14px 28px; }

    /* Panels */
    .panel{
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.78);
      padding: 14px;
      margin: 12px 0 14px;
      text-align:left;
    }
    .panel h3{ margin:0 0 10px 0; font-size:14px; letter-spacing:.2px; }
    .muted{ color:#6F675D; }

    /* Rules */
    .rules{
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(231,220,200,.35);
      border-radius: 12px;
      padding: 10px 10px 9px;
      font-size: 13px;
      color:#222;
      margin-bottom: 12px;
      line-height: 1.45;
    }
    .rules b{ font-weight:700; }
    .rules .bad{ color:#9b1c1c; font-weight:700; }
    .rules .good{ color:#0a7a3b; font-weight:700; }

    /* Composer */
    .composer-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 920px){
      .composer-grid{ grid-template-columns: 1fr; }
    }
    label{ display:block; font-size:12px; color:#444; margin: 0 0 6px; }
    select,input,textarea{
      width:100%;
      font: inherit;
      font-size:13px;
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      outline: none;
    }
    textarea{ min-height: 104px; resize: vertical; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px; padding: 8px 10px; border-radius: 10px;
      border: 1px solid rgba(0,0,0,.12); background:#fff; color:#222;
      text-decoration:none; font-size:13px; cursor:pointer;
    }
    .btn:hover{ background:#f7f5f1; }
    .btn.secondary{ background: rgba(231,220,200,.35); border-color: rgba(0,0,0,.10); }

    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content: space-between;
      margin-top: 10px;
    }
    .note{ font-size:12px; color:#6F675D; line-height:1.4; }

    .divider{ height:1px; background: rgba(0,0,0,.08); margin: 12px 0; }

    /* Feed */
    .feed-list{ display:flex; flex-direction:column; gap:10px; margin-top: 10px; }
    .post{
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 12px;
      background: #fff;
      padding: 12px;
    }
    .post-top{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content: space-between; align-items: baseline;
      margin-bottom: 6px;
    }
    .badge{
      display:inline-flex; align-items:center;
      padding: 3px 8px; border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(231,220,200,.35);
      font-size: 12px; color:#222; font-weight:700;
    }
    .post-title{ margin:0; font-size:14px; font-weight:800; color:#222; }
    .post-meta{ font-size:12px; color:#6F675D; white-space:nowrap; }
    .post-body{ font-size:13px; line-height:1.55; color:#222; white-space:pre-wrap; margin: 6px 0 0; }

    .empty{
      padding: 12px;
      border-radius: 12px;
      background: #fafafa;
      border: 1px solid #eee;
      color:#444;
      font-size: 13px;
      line-height: 1.55;
    }

    /* Chart placeholder section */
    .chart-slot{
      border: 1px dashed rgba(0,0,0,.22);
      border-radius: 12px;
      background: rgba(255,255,255,.55);
      padding: 12px;
      min-height: 92px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color:#6F675D;
      font-size: 13px;
      line-height: 1.5;
    }
  </style>
</head>

<body>
  <div class="wrap" id="top">

    <header class="site-header">
      <h1 class="logo"><a href="/" aria-label="Go to PTD Today home">PTD Today</a></h1>
      <p class="motto">First to Know. First to Lead.</p>

      <nav class="ptd-nav" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ai.html">AI</a>
        <a href="/briefs.html">Briefs</a>
        <a href="/room.html" class="active">Room</a>
      </nav>

      <h2 class="section">PTD Intelligence Room</h2>
      <div class="updated" id="updated" role="status" aria-live="polite">Updated — …</div>
    </header>

    <main class="wrap-inner" role="main">

      <!-- 1) ROOM FEED + POSTING (TOP) -->
      <section class="panel" aria-label="Room feed and posting">
        <h3>Room feed</h3>

        <div class="rules" role="note" aria-label="Room rules">
          <div><b>Allowed:</b> <span class="good">Grid • Transmission • Substations • HVDC • Data Centers • AI/Chips • Renewables • Storage • Oil &amp; Gas (infrastructure) • Critical minerals</span></div>
          <div><b>Not allowed:</b> <span class="bad">Politics / elections / general geopolitics</span></div>
          <div class="muted" style="margin-top:6px;">
            Keep it professional &amp; clean. No insults, no profanity, no harassment, no spam.
          </div>
        </div>

        <h3>Post a need (UI-only for now)</h3>

        <div class="composer-grid" aria-label="Post composer">
          <div>
            <label for="category">Category</label>
            <select id="category">
              <option value="Job">Job</option>
              <option value="Resource">Resource</option>
              <option value="Equipment">Equipment</option>
              <option value="Device">Device</option>
              <option value="Labor">Labor</option>
              <option value="Advice">Advice</option>
              <option value="Recommendation">Recommendation</option>
            </select>

            <div style="height:10px;"></div>

            <label for="title">Title (short)</label>
            <input id="title" maxlength="120" placeholder="Example: Looking for GIS commissioning engineer (Middle East, 6 months)" />

            <div style="height:10px;"></div>

            <label for="contact">Contact (optional)</label>
            <input id="contact" maxlength="120" placeholder="Email / LinkedIn / Company website" />
          </div>

          <div>
            <label for="details">Details</label>
            <textarea id="details" maxlength="2000" placeholder="What do you need? Scope, location, timeline, constraints, budget (optional), and what a good response looks like. Keep it professional."></textarea>

            <div style="height:10px;"></div>

            <label for="tags">Tags (optional)</label>
            <input id="tags" maxlength="120" placeholder="Example: HVDC, GIS, EPC, 500kV, data center, transformers" />
          </div>
        </div>

        <div class="row">
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn secondary" id="copyPost">Copy as PTD post</button>
            <button class="btn" id="clearPost">Clear</button>
            <a class="btn" href="/briefs.html" target="_blank" rel="noopener">Open Briefs</a>
          </div>
          <span class="note">Posting is disabled in v1. Next step: PTD “Post Gateway” (AI moderation + publish).</span>
        </div>

        <div class="divider"></div>

        <h3>Latest posts</h3>
        <div class="muted" style="font-size:12px;">(UI-only list. In the next step, this will load real posts.)</div>

        <div class="feed-list" id="feed">
          <div class="empty">
            No posts yet.<br/>
            Once the backend is enabled, approved posts will appear here automatically.
          </div>
        </div>
      </section>

      <!-- 2) SINGLE CHART SECTION (BELOW) -->
      <section class="panel" aria-label="Single chart section">
        <h3>Single chart section (placeholder)</h3>
        <div class="chart-slot">
          This area is reserved for a single chart (example: “Weekly PTD Signal Mix” or “Top sectors — last 7 days”).<br/>
          We’ll wire this to your weekly JSON next.
        </div>
      </section>

    </main>

    <footer class="footer">
      <p>© <span id="yr"></span> PTD Today — Intelligence Room.</p>
      <p class="muted">UI-only prototype. Publishing will be enabled via PTD Post Gateway (with AI moderation).</p>
    </footer>

  </div>

  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();
    const updatedEl = document.getElementById('updated');
    if(updatedEl){
      updatedEl.textContent = "Updated — " + new Date().toISOString().replace('T',' ').replace(/:\d\d\.\d{3}Z$/,'Z');
    }

    function clean(s){ return String(s || "").trim(); }

    function buildPostText(){
      const category = clean(document.getElementById('category')?.value);
      const title = clean(document.getElementById('title')?.value);
      const details = clean(document.getElementById('details')?.value);
      const tags = clean(document.getElementById('tags')?.value);
      const contact = clean(document.getElementById('contact')?.value);

      const lines = [];
      lines.push(`[PTD ROOM] ${category}${title ? " — " + title : ""}`);
      if(tags) lines.push(`Tags: ${tags}`);
      if(contact) lines.push(`Contact: ${contact}`);
      lines.push("");
      lines.push(details || "(Add details)");
      lines.push("");
      lines.push("Rules: Professional only. No politics/elections. Energy & infrastructure focus.");
      return lines.join("\n");
    }

    // Copy as PTD post
    document.getElementById("copyPost")?.addEventListener("click", async () => {
      try{
        const txt = buildPostText();
        await navigator.clipboard.writeText(txt);
      }catch(e){}
    });

    // Clear
    document.getElementById("clearPost")?.addEventListener("click", () => {
      document.getElementById('title').value = "";
      document.getElementById('details').value = "";
      document.getElementById('tags').value = "";
      document.getElementById('contact').value = "";
      document.getElementById('category').value = "Job";
    });

    // Optional: load real feed later from /data/room_feed.json (when you publish it)
    // We keep it "silent" if missing.
    (async function tryLoadFeed(){
      const feedEl = document.getElementById("feed");
      if(!feedEl) return;

      try{
        const res = await fetch("/data/room_feed.json", { cache: "no-store" });
        if(!res.ok) return;
        const data = await res.json();
        const items = Array.isArray(data.items) ? data.items : [];
        if(items.length === 0) return;

        feedEl.innerHTML = "";
        for(const it of items.slice(0, 20)){
          const category = (it.category || "Post").toString();
          const title = (it.title || "").toString();
          const body = (it.body || "").toString();
          const ts = (it.created_at || "").toString();

          const card = document.createElement("div");
          card.className = "post";
          card.innerHTML = `
            <div class="post-top">
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <span class="badge">${escapeHtml(category)}</span>
                <p class="post-title">${escapeHtml(title || "(No title)")}</p>
              </div>
              <span class="post-meta">${escapeHtml(ts ? ("Updated: " + ts) : "")}</span>
            </div>
            <div class="post-body">${escapeHtml(body)}</div>
          `;
          feedEl.appendChild(card);
        }
      } catch(e){ /* ignore */ }
    })();

    function escapeHtml(s){
      return String(s || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
  </script>
</body>
</html>