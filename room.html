<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Analytics 4 -->
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVKD1RLFE5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-TVKD1RLFE5');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#E7DCC8" />
  <meta name="color-scheme" content="light only" />
  <meta name="description" content="PTD Intelligence Room: a focused community space for Grid, AI, Data Centers, Renewables, and Energy infrastructure." />
  <link rel="canonical" href="https://ptdtoday.com/room.html" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />

  <!-- Social -->
  <meta property="og:site_name" content="PTD Today" />
  <meta property="og:title" content="PTD Today — Intelligence Room" />
  <meta property="og:description" content="A focused space for Grid, AI, Data Centers, Renewables, and Energy infrastructure." />
  <meta property="og:image" content="/assets/og-default.png" />
  <meta property="og:url" content="https://ptdtoday.com/room.html" />
  <meta name="twitter:card" content="summary_large_image" />

  <title>PTD Today — Intelligence Room</title>

  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="stylesheet" href="/assets/main.css" />

  <style>
    header.site-header { text-align: center; margin: 34px 10px 18px; }
    header.site-header h1 { margin: 0 0 6px; font-size: 56px; line-height: 1; letter-spacing: .2px; }
    header.site-header h1 a { color: inherit; text-decoration: none; }
    header.site-header .motto { margin: 2px 0 10px; color: #6F675D; font-style: italic; font-size: 18px; }

    .ptd-nav { display: flex; justify-content: center; gap: 22px; margin: 6px 0 16px; font-size: 14px; flex-wrap: wrap; }
    .ptd-nav a { text-decoration: none; color: #222; padding: 6px 10px; border-radius: 999px; }
    .ptd-nav a:hover { background: #f1ece3; }
    .ptd-nav a.active { font-weight: 600; background: #e7dcc8; }

    .room-wrap{ max-width: 980px; margin: 0 auto; padding: 0 14px 24px; }

    .brief-box{
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.75);
      padding: 14px 14px 12px;
      margin: 10px 0 14px;
      text-align: left;
    }
    .brief-top{ display: flex; justify-content: space-between; align-items: baseline; gap: 12px; flex-wrap: wrap; margin-bottom: 8px; }
    .brief-title{ margin: 0; font-size: 14px; letter-spacing: .2px; color: #222; font-weight: 700; }
    .brief-meta{ font-size: 12px; color: #6F675D; white-space: nowrap; }
    .brief-body{ font-size: 14px; line-height: 1.55; color: #222; }
    .brief-body ul{ margin: 6px 0 8px 18px; padding: 0; }
    .brief-body li{ margin: 4px 0; }
    .muted{ color:#6F675D; }
    .brief-note{ margin-top: 10px; font-size: 12px; color: #6F675D; }

    .room-grid{ display: grid; grid-template-columns: 1.25fr 0.75fr; gap: 18px; align-items: start; }
    @media (max-width: 980px){ .room-grid{ grid-template-columns: 1fr; } }

    .panel{ border: 1px solid rgba(0,0,0,.10); border-radius: 14px; background: #fff; padding: 14px; }
    .panel h3{ margin: 0 0 8px 0; font-size: 14px; letter-spacing: .2px; }

    .rules{
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(231,220,200,.35);
      border-radius: 12px;
      padding: 10px 10px 9px;
      font-size: 13px;
      color:#222;
      margin-bottom: 12px;
    }
    .rules b{ font-weight: 700; }
    .rules .bad{ color:#9b1c1c; font-weight:600; }
    .rules .good{ color:#0a7a3b; font-weight:600; }

    .signals-box{
      margin: 10px 0 12px;
      padding: 10px 12px;
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 12px;
      background: rgba(255,255,255,.70);
    }
    .signals-head{ display:flex; align-items:baseline; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .signals-meta{ font-size: 12px; color:#6F675D; white-space: nowrap; }
    .signals-box ul{ margin: 8px 0 0 18px; padding: 0; color:#222; }
    .signals-box li{ margin: 4px 0; }

    .feed-empty{
      padding: 12px;
      border-radius: 12px;
      background: #fafafa;
      border: 1px solid #eee;
      color:#444;
      font-size: 13px;
      line-height: 1.55;
    }

    .sticky{ position: sticky; top: 12px; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      color:#222;
      text-decoration:none;
      font-size: 13px;
      cursor:pointer;
    }
    .btn:hover{ background:#f7f5f1; }
    .btn.secondary{
      background: rgba(231,220,200,.35);
      border-color: rgba(0,0,0,.10);
    }

    .suggestions{ display:flex; flex-direction:column; gap:8px; margin-top: 10px; }
    .chip{
      width:100%;
      text-align:left;
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.10);
      background: #fafafa;
      cursor:pointer;
      font-size: 13px;
      color:#222;
      line-height: 1.35;
    }
    .chip:hover{ background:#f3efe7; }

    .divider{ height:1px; background: rgba(0,0,0,.08); margin: 12px 0; }

    .composer{ margin-top: 12px; display:flex; gap:10px; align-items:flex-start; flex-wrap: wrap; }
    .composer textarea{
      width:100%;
      min-height: 110px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.12);
      font: inherit;
      resize: vertical;
      background:#fff;
    }
    .composer .row{
      display:flex;
      gap:10px;
      width:100%;
      justify-content: space-between;
      align-items:center;
      flex-wrap: wrap;
    }
    .note{ font-size: 12px; color:#6F675D; line-height: 1.4; }
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  </style>
</head>

<body>
  <div class="wrap" id="top">

    <header class="site-header">
      <h1 class="logo">
        <a href="/" aria-label="Go to PTD Today home">PTD Today</a>
      </h1>
      <p class="motto">First to Know. First to Lead.</p>

      <nav class="ptd-nav" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ai.html">AI</a>
        <a href="/briefs.html">Briefs</a>
        <a href="/room.html" class="active">Room</a>
      </nav>

      <h2 class="section">PTD Intelligence Room</h2>
      <div class="updated" id="updated" role="status" aria-live="polite">Loading…</div>
    </header>

    <main class="main room-wrap" role="main">

      <!-- Today’s Focus (reads /data/home_summary.json) -->
      <section class="brief-box" aria-label="Today’s Focus">
        <div class="brief-top">
          <p class="brief-title">Today’s Focus (from PTD Daily Brief)</p>
          <span class="brief-meta" id="briefUpdated">Loading…</span>
        </div>
        <div class="brief-body" id="briefBody"><p class="muted">Preparing…</p></div>
        <div class="brief-note">Informational only — may contain errors.</div>
      </section>

      <section class="room-grid" aria-label="Room content">
        <!-- Left: Room feed + composer (UI only) -->
        <div class="panel" aria-label="Room feed">
          <h3>Room feed</h3>

          <div class="rules" role="note" aria-label="Room rules">
            <div><b>Allowed:</b> <span class="good">Grid • AI • Data Centers • Renewables • Oil &amp; Gas (infrastructure)</span></div>
            <div><b>Not allowed:</b> <span class="bad">Politics / elections / general geopolitics</span></div>
          </div>

          <!-- ✅ Today’s PTD Signals -->
          <div class="signals-box" aria-label="Today’s PTD signals">
            <div class="signals-head">
              <strong>Today’s PTD Signals</strong>
              <span class="signals-meta" id="signalsUpdated">Loading…</span>
            </div>
            <ul id="signalsList">
              <li class="muted">Loading signals from Briefs…</li>
            </ul>

            <div class="btnrow" style="margin-top:10px;">
              <button class="btn secondary" id="insertSignals">Insert signals into draft</button>
              <button class="btn" id="makeLinkedIn">Generate LinkedIn post (from signals)</button>
              <a class="btn" href="/briefs.html" target="_blank" rel="noopener">Open Briefs</a>
            </div>

            <div class="note" style="margin-top:8px;">
              Source: PTD briefs (headline-based). If signals are missing, it means the brief file isn’t published yet.
            </div>
          </div>

          <div class="feed-empty">
            <b>Coming soon:</b> interactive discussion inside PTD Today.<br/>
            For now, use the AI panel on the right to craft a tight, on-topic LinkedIn post — then share it in your groups to drive traffic here.
          </div>

          <div class="divider"></div>

          <h3>Draft a message (UI-only)</h3>
          <div class="composer">
            <textarea id="draft" placeholder="Write your message here… (UI only for now)"></textarea>

            <div class="row">
              <div class="btnrow">
                <button class="btn secondary" id="copyDraft">Copy draft</button>
                <button class="btn" id="clearDraft">Clear</button>
              </div>
              <span class="note">Posting inside PTD Room is disabled in v1 (no backend yet).</span>
            </div>
          </div>
        </div>

        <!-- Right: AI Moderator panel (UI only) -->
        <aside class="panel sticky" aria-label="AI moderator panel">
          <h3>AI Moderator Panel (UI)</h3>
          <div class="note">
            Use these prompts to keep everything aligned with PTD Today’s focus areas.
            The buttons automatically include today’s PTD signals (if available).
          </div>

          <div class="divider"></div>

          <h3>Suggested prompts</h3>
          <div class="suggestions">
            <button class="chip" data-template="From today’s PTD signals, what are the 3 biggest themes impacting Grid & Transmission planning? Keep it factual. No politics.">
              Grid & Transmission — top 3 themes
            </button>
            <button class="chip" data-template="Based on today’s PTD signals, summarize what this implies for AI/Data Centers power demand and infrastructure constraints. No politics.">
              AI & Data Centers — demand + constraints
            </button>
            <button class="chip" data-template="Convert today’s PTD signals into an executive LinkedIn post: short, actionable, and strictly on Grid/AI/Data Centers/Renewables/O&amp;G infrastructure. No politics.">
              LinkedIn post — executive style
            </button>
            <button class="chip" data-template="What OEM/EPC implications can be inferred from today’s PTD signals only? If unclear, say “not enough info.” No politics.">
              OEM/EPC implications — headline-only
            </button>
          </div>

          <div class="divider"></div>

          <h3>Copy-ready LinkedIn hook</h3>
          <div class="note" id="hookText">
            “Day-by-day, the Grid + AI/Data Center story is tightening planning timelines. Here are today’s signals from PTD Today…”
          </div>
          <div style="margin-top:10px;">
            <button class="btn secondary" id="copyHook">Copy hook</button>
          </div>
        </aside>
      </section>
    </main>

    <footer class="footer">
      <p>© <span id="yr"></span> PTD Today — Intelligence Room.</p>
      <p class="muted">This page is a UI-only prototype. Interactive posting will be added in a later version.</p>
    </footer>

  </div>

  <script>
    document.getElementById('yr').textContent = new Date().getFullYear();

    const updatedEl = document.getElementById('updated');
    if(updatedEl) updatedEl.textContent = "Updated — " + new Date().toISOString().replace('T',' ').replace(/:\d\d\.\d{3}Z$/,'Z');

    // ---- Helpers ----
    function escapeHtml(s){
      return String(s || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function renderBriefMarkdown(md){
      const raw = (md || "").replace(/\r\n/g, "\n").trim();
      if(!raw) return "<p class='muted'>No brief yet.</p>";

      const lines = raw.split("\n");
      let html = "";
      let inList = false;

      function closeList(){
        if(inList){ html += "</ul>"; inList = false; }
      }

      for (let line of lines){
        line = line.trim();
        if(!line){ closeList(); continue; }

        const isBullet = line.startsWith("- ") || line.startsWith("• ");
        if(isBullet){
          if(!inList){ html += "<ul>"; inList = true; }
          html += "<li>" + escapeHtml(line.replace(/^(- |• )/, "")) + "</li>";
          continue;
        }

        closeList();
        html += "<p>" + escapeHtml(line) + "</p>";
      }

      closeList();
      return html;
    }

    // ---- Load Today’s Focus from /data/home_summary.json ----
    (async function(){
      const bUpd = document.getElementById("briefUpdated");
      const bBody = document.getElementById("briefBody");

      try{
        const res = await fetch("/data/home_summary.json", { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        bUpd.textContent = "Updated: " + (data.updated_at || new Date().toISOString());
        bBody.innerHTML = renderBriefMarkdown((data.summary_md || "").trim());
      }catch(e){
        bUpd.textContent = "Not available yet";
        bBody.innerHTML = "<p class='muted'>Once <code>/data/home_summary.json</code> is published, Today’s Focus will appear here.</p>";
      }
    })();

    // ---- PTD Signals (from briefs) ----
    // Switch to "/data/briefs/daily.json" later if desired.
    const BRIEF_URL = "/data/briefs/weekly.json";

    function extractTopThemeBullets(mdText, maxBullets = 6) {
      const md = (mdText || "").replace(/\r\n/g, "\n");
      const lower = md.toLowerCase();
      const idx = lower.indexOf("top themes");
      const slice = idx >= 0 ? md.slice(idx) : md;

      const lines = slice.split("\n");
      const bullets = [];

      for (const line of lines) {
        const t = (line || "").trim();

        // Stop when we hit another numbered section like "## 2) Top Stories"
        if (bullets.length > 0 && /^#{1,6}\s*\d+\)/.test(t)) break;

        // Capture bullets
        if (t.startsWith("- ")) bullets.push(t.slice(2).trim());
        else if (t.startsWith("• ")) bullets.push(t.slice(2).trim());

        if (bullets.length >= maxBullets) break;
      }

      return bullets.filter(Boolean);
    }

    async function loadSignals(){
      const updEl = document.getElementById("signalsUpdated");
      const listEl = document.getElementById("signalsList");

      try{
        const res = await fetch(BRIEF_URL, { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        updEl.textContent = "Updated: " + (data.updated_at || "—");

        const bullets = extractTopThemeBullets(data.summary_md, 6);

        if(!bullets.length){
          listEl.innerHTML = "<li class='muted'>No PTD signals found in the brief yet.</li>";
          window.PTD_SIGNALS = [];
          return;
        }

        listEl.innerHTML = bullets.map(b => "<li>" + escapeHtml(b) + "</li>").join("");
        window.PTD_SIGNALS = bullets;

      }catch(e){
        updEl.textContent = "Signals not available yet";
        listEl.innerHTML = "<li class='muted'>Waiting for briefs file to be generated/committed.</li>";
        window.PTD_SIGNALS = [];
      }
    }
    loadSignals();

    // ---- UI actions ----
    const draft = document.getElementById("draft");

    function ensureSignalsText(){
      const s = (window.PTD_SIGNALS || []).slice(0, 6);
      if(!s.length) return "No signals available yet (brief not published).";
      return s.map(x => "- " + x).join("\n");
    }

    document.getElementById("insertSignals")?.addEventListener("click", () => {
      if(!draft) return;
      const block = "Today’s PTD Signals:\n" + ensureSignalsText();
      draft.value = (draft.value ? (draft.value + "\n\n") : "") + block;
      draft.focus();
    });

    document.getElementById("makeLinkedIn")?.addEventListener("click", () => {
      if(!draft) return;

      const hook = document.getElementById("hookText")?.textContent || "";
      const signals = (window.PTD_SIGNALS || []).slice(0, 6);

      let body = hook.trim() + "\n\n";

      if(signals.length){
        body += "Key signals (headline-based):\n";
        body += signals.map(s => "• " + s).join("\n");
        body += "\n\n";
        body += "What I’m watching next:\n";
        body += "• Grid interconnection + permitting bottlenecks\n";
        body += "• Data center power availability + substation lead times\n";
        body += "• Renewable buildout + storage economics\n\n";
      } else {
        body += "Key signals: (not available yet)\n";
        body += "• Brief file hasn’t been published/updated.\n\n";
      }

      body += "Read the full brief here: https://ptdtoday.com/briefs.html\n";
      body += "#PowerTransmission #Grid #DataCenters #AI #Renewables #EnergyInfrastructure";

      draft.value = body;
      draft.focus();
    });

    // Prompt chips -> paste into draft (UI-only), auto-including signals
    document.querySelectorAll(".chip").forEach(btn => {
      btn.addEventListener("click", () => {
        const tpl = btn.getAttribute("data-template") || "";
        const signals = ensureSignalsText();
        const prompt =
          tpl +
          "\n\nToday’s PTD signals (use these only):\n" + signals +
          "\n\nHard rule: exclude politics/elections/general geopolitics. Stay on Grid/AI/Data Centers/Renewables/O&G infrastructure.";

        if(!draft) return;
        draft.value = (draft.value ? (draft.value + "\n\n") : "") + prompt;
        draft.focus();
      });
    });

    // Copy draft
    document.getElementById("copyDraft")?.addEventListener("click", async () => {
      try{ await navigator.clipboard.writeText(draft?.value || ""); }catch(e){}
    });

    // Clear draft
    document.getElementById("clearDraft")?.addEventListener("click", () => {
      if(!draft) return;
      draft.value = "";
      draft.focus();
    });

    // Copy hook
    document.getElementById("copyHook")?.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(document.getElementById("hookText")?.textContent || "");
      }catch(e){}
    });
  </script>
</body>
</html>