<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>PTD Today — Media</title>
  <meta name="description" content="PTD Today Media — today’s YouTube videos with AI summaries for power transmission, substations, data centers, renewables, and critical minerals." />
  <link rel="canonical" href="https://ptdtoday.com/media.html" />

  <!-- Open Graph (Media) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="PTD Today" />
  <meta property="og:title" content="PTD Today — Media" />
  <meta property="og:description" content="Today’s curated YouTube videos with AI summaries + PTD-style writeups." />
  <meta property="og:url" content="https://ptdtoday.com/media.html" />
  <meta property="og:image" content="https://ptdtoday.com/assets/og-default.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="PTD Today — Media" />
  <meta name="twitter:description" content="Today’s curated YouTube videos with AI summaries + PTD-style writeups." />
  <meta name="twitter:image" content="https://ptdtoday.com/assets/og-default.png" />

  <style>
    :root{
      --bg:#ffffff;
      --paper:#ffffff;
      --ink:#111111;
      --muted:#5c5c5c;
      --rule:rgba(0,0,0,.15);
      --soft:rgba(0,0,0,.06);
      --pill:rgba(0,0,0,.04);
      --btn:#111;
      --btnInk:#fff;
      --card:#fff;
      --warnBg: rgba(255, 244, 214, 0.8);
      --warnInk: #6b4e00;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family: Georgia, "Times New Roman", Times, serif;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    a{color:inherit}

    .wrap{max-width:980px;margin:0 auto;padding:26px 16px 60px}

    .mast{text-align:center;padding:16px 0 6px}
    .brand{
      margin:0;
      font-size:52px;
      letter-spacing:.2px;
      font-weight:700;
      text-decoration:none;
      display:inline-block;
    }
    .tagline{margin:6px 0 10px;color:var(--muted);font-style:italic;font-size:16px}

    .nav{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin:10px 0 10px}
    .nav a{
      text-decoration:none;
      padding:7px 12px;
      border-radius:999px;
      border:1px solid transparent;
      color:rgba(0,0,0,.75);
      font-size:15px;
    }
    .nav a:hover{border-color:var(--rule);background:rgba(0,0,0,.02)}
    .nav a.active{border-color:var(--rule);background:rgba(0,0,0,.03);font-weight:700;color:rgba(0,0,0,.92)}

    .rule{height:1px;background:var(--rule);margin:14px 0 0}

    .pageTitle{
      text-align:center;
      margin:18px 0 2px;
      font-size:44px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .updated{text-align:center;color:var(--muted);font-size:15px;margin:6px 0 18px}

    .panel{
      background:var(--paper);
      border:1px solid var(--rule);
      border-radius:14px;
      overflow:hidden;
    }

    .toolbar{
      display:flex;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--rule);
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid var(--rule);
      background:var(--btn);
      color:var(--btnInk);
      padding:9px 14px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:14px;
    }
    .btn:hover{filter:brightness(.98)}

    .search{flex:1 1 320px;display:flex;align-items:center;margin-left:auto}
    .search input{
      width:100%;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:#fff;
      font-family:inherit;
      font-size:14px;
      outline:none;
    }

    .notice{
      padding:12px 14px;
      border-bottom:1px solid var(--rule);
      color:rgba(0,0,0,.80);
      font-size:14px;
      background:rgba(0,0,0,.02);
    }

    .headRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 14px;
      border-bottom:1px solid var(--rule);
      background:#fff;
      align-items:center;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:var(--pill);
      font-size:13px;
      color:rgba(0,0,0,.78);
    }
    .tiny{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1fr}

    .card{
      padding:16px 14px;
      border-bottom:1px solid var(--soft);
      background:var(--card);
    }
    .card:last-child{border-bottom:none}

    .meta{
      color:var(--muted);
      font-size:12px;
      letter-spacing:.14px;
      text-transform:uppercase;
      margin-bottom:8px;
    }

    .row{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:14px;
      align-items:start;
    }
    .thumb{
      width:100%;
      border-radius:12px;
      overflow:hidden;
      border:1px solid var(--rule);
      background:#f4f4f4;
      position:relative;
      display:block;
      text-decoration:none;
    }
    .thumb img{
      width:100%;
      height:auto;
      display:block;
    }
    .play{
      position:absolute;
      right:10px;
      bottom:10px;
      background:rgba(0,0,0,.78);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      letter-spacing:.1px;
    }

    h2{
      margin:0 0 10px;
      font-size:28px;
      line-height:1.1;
      font-weight:900;
    }
    .summary{
      margin:0 0 12px;
      font-size:16px;
      line-height:1.6;
      color:rgba(0,0,0,.86);
    }

    .subhead{
      margin:12px 0 6px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12px;
      color:var(--muted);
    }
    ul{margin:0 0 10px;padding-left:18px}
    li{margin:6px 0;line-height:1.35}

    .cta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }
    .btnMini{
      appearance:none;
      border:1px solid var(--rule);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:13px;
      color:#111;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      line-height:1;
      user-select:none;
    }
    .btnMini.primary{
      background:#111;
      color:#fff;
      border-color:#111;
    }

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      display:inline-flex;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:rgba(0,0,0,.02);
      font-size:12px;
      color:rgba(0,0,0,.76);
    }

    .warnBox{
      padding:14px;
      margin:14px;
      border:1px solid rgba(140,100,0,.25);
      border-radius:12px;
      background:var(--warnBg);
      color:var(--warnInk);
    }

    .errorBox{
      padding:18px;
      margin:14px;
      border:1px solid rgba(150,0,0,.18);
      border-radius:12px;
      background:rgba(255,230,230,.55);
      color:#7a1f1f;
    }

    .footer{text-align:center;margin-top:18px;color:var(--muted);font-size:13px}

    @media (max-width:820px){
      .brand{font-size:44px}
      .pageTitle{font-size:36px}
      .row{grid-template-columns:1fr}
      h2{font-size:24px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="mast">
      <a class="brand" href="/" aria-label="PTD Today home">PTD Today</a>
      <div class="tagline">First to Know. First to Lead.</div>

      <nav class="nav" aria-label="Primary navigation">
        <a href="/index.html">Home</a>
        <a href="/room.html">Room</a>
        <a class="active" href="/media.html">Media</a>
      </nav>

      <div class="rule"></div>
    </header>

    <h1 class="pageTitle">Media</h1>
    <div class="updated" id="updatedLine">Loading…</div>

    <section class="panel" aria-label="Media videos">
      <div class="toolbar">
        <button class="btn" id="btnRefresh" type="button">Refresh</button>
        <div class="search">
          <input id="q" type="search" placeholder="Search today’s videos (title, channel, tags)..." autocomplete="off" />
        </div>
      </div>

      <div class="notice" id="disclaimerLine">
        Informational only — AI-generated summaries; may contain errors. Verify with the original video.
      </div>

      <div class="headRow">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <span class="pill" id="countPill">Videos today: —</span>
          <span class="pill" id="todayPill">Today (UTC): —</span>
        </div>
        <div class="tiny" id="hintLine">Showing videos published since 00:00 UTC</div>
      </div>

      <div class="grid" id="grid"></div>
    </section>

    <div class="footer">© <span id="year"></span> PTD Today</div>
  </div>

  <script>
    // Expects: /data/media.json with ITEMS AS VIDEOS (id = YouTube videoId)
    const DATA_URL = "/data/media.json";
    const $ = (id) => document.getElementById(id);

    function fmtUtc(iso){
      try{ return new Date(iso).toUTCString().replace("GMT","UTC"); }
      catch(e){ return iso || ""; }
    }
    function normalize(s){ return (s || "").toString().toLowerCase(); }
    function escapeHtml(str){
      return (str ?? "").toString()
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }

    function utcMidnightMs(d = new Date()){
      return Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate(), 0, 0, 0, 0);
    }

    function videoThumb(v){
      // Prefer data thumbnail, else derive from YouTube video id
      const id = (v.id || "").toString().trim();
      const t = (v.thumbnail || v.image || "").toString().trim();
      if (t) return t;
      if (id) return `https://i.ytimg.com/vi/${encodeURIComponent(id)}/hqdefault.jpg`;
      return "";
    }

    function videoUrl(v){
      const u = (v.url || "").toString().trim();
      if (u) return u;
      const id = (v.id || "").toString().trim();
      if (id) return `https://www.youtube.com/watch?v=${encodeURIComponent(id)}`;
      return "";
    }

    function ptdSummaryUrl(videoId){
      return `${window.location.origin}/media/${encodeURIComponent(videoId)}.html`;
    }

    async function shareLink(title, text, url){
      if (navigator.share) {
        try { await navigator.share({ title, text, url }); return; }
        catch(e){ return; }
      }
      const draft = `${title}\n\n${text}\n\n${url}`;
      try{
        await navigator.clipboard.writeText(draft);
        alert("Copied draft:\n\n" + draft);
      }catch(e){
        prompt("Copy this draft:", draft);
      }
    }

    function applySearch(items, q){
      q = normalize(q).trim();
      if(!q) return items;
      return items.filter(v=>{
        const hay = [
          v.title, v.channel, v.publisher,
          v.ai && v.ai.summary,
          ...(v.ai && Array.isArray(v.ai.bullets) ? v.ai.bullets : []),
          ...(v.ai && Array.isArray(v.ai.takeaways) ? v.ai.takeaways : []),
          ...(v.ai && Array.isArray(v.ai.tags) ? v.ai.tags : [])
        ].map(normalize).join(" ");
        return hay.includes(q);
      });
    }

    function isVideoShape(items){
      // We expect: id (videoId), title, published_at, url (watch), channel, thumbnail, ai.*
      if(!items.length) return true;
      const sample = items[0] || {};
      const id = (sample.id || "").toString();
      const hasVideoLikeId = id.length >= 8 && !id.startsWith("@") && !id.includes(" ");
      // If user accidentally gave channels list, url will be channel URL and id won't be videoId-ish
      return hasVideoLikeId;
    }

    function cardHtml(v){
      const id = (v.id || "").toString().trim();
      const title = (v.title || "Untitled").toString();
      const channel = (v.channel || v.publisher || "YouTube").toString();
      const published = v.published_at || v.published || "";
      const url = videoUrl(v);
      const thumb = videoThumb(v);

      const ai = v.ai || {};
      const summary = (ai.summary || "").toString().trim();
      const bullets = Array.isArray(ai.bullets) ? ai.bullets : [];
      const takeaways = Array.isArray(ai.takeaways) ? ai.takeaways : [];
      const tags = Array.isArray(ai.tags) ? ai.tags : [];

      const meta = [
        "VIDEO",
        channel,
        published ? fmtUtc(published) : ""
      ].filter(Boolean).join(" • ");

      const shareUrl = ptdSummaryUrl(id);

      return `
        <article class="card">
          <div class="meta">${escapeHtml(meta)}</div>
          <div class="row">
            <a class="thumb" href="${escapeHtml(url)}" target="_blank" rel="noopener" aria-label="Open on YouTube">
              ${thumb ? `<img loading="lazy" src="${escapeHtml(thumb)}" alt="">` : ""}
              <span class="play">▶ Watch</span>
            </a>

            <div>
              <h2>${escapeHtml(title)}</h2>

              ${summary ? `<p class="summary">${escapeHtml(summary)}</p>` : ""}

              ${bullets.length ? `
                <div class="subhead">Key points</div>
                <ul>${bullets.slice(0,6).map(b=>`<li>${escapeHtml(b)}</li>`).join("")}</ul>
              ` : ""}

              ${takeaways.length ? `
                <div class="subhead">So what</div>
                <ul>${takeaways.slice(0,6).map(t=>`<li>${escapeHtml(t)}</li>`).join("")}</ul>
              ` : ""}

              ${tags.length ? `
                <div class="chips">
                  ${tags.slice(0,12).map(t=>`<span class="chip">${escapeHtml(t)}</span>`).join("")}
                </div>
              ` : ""}

              <div class="cta">
                <a class="btnMini primary" href="${escapeHtml(shareUrl)}" target="_blank" rel="noopener">Open PTD Summary</a>
                <a class="btnMini" href="${escapeHtml(url)}" target="_blank" rel="noopener">YouTube</a>
                <button class="btnMini" type="button"
                  data-share="${escapeHtml(shareUrl)}"
                  data-title="${escapeHtml(title)}"
                  data-text="${escapeHtml((summary || "").slice(0,220))}">
                  Share
                </button>
              </div>
            </div>
          </div>
        </article>
      `;
    }

    function bindShareButtons(){
      document.querySelectorAll("button[data-share]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const url = btn.getAttribute("data-share") || location.href;
          const title = btn.getAttribute("data-title") || "PTD Today";
          const text = btn.getAttribute("data-text") || "";
          await shareLink(title, text, url);
        });
      });
    }

    function filterTodayUtc(items){
      const cut = utcMidnightMs(new Date());
      return (items || []).filter(v=>{
        const iso = v.published_at || v.published || "";
        const t = Date.parse(iso);
        if (!Number.isFinite(t)) return false;
        return t >= cut;
      });
    }

    function render(payload, query=""){
      const updatedAt = payload.updated_at || "";
      $("updatedLine").textContent = updatedAt ? `Updated — ${fmtUtc(updatedAt)}` : "Updated —";

      $("disclaimerLine").textContent =
        payload.disclaimer ||
        "Informational only — AI-generated summaries; may contain errors. Verify with the original video.";

      const all = Array.isArray(payload.items) ? payload.items : [];

      // Today-only (UTC)
      const today = filterTodayUtc(all);
      const items = applySearch(today, query);

      const utcToday = new Date(utcMidnightMs(new Date()));
      $("todayPill").textContent = `Today (UTC): ${utcToday.toISOString().slice(0,10)}`;
      $("countPill").textContent = `Videos today: ${items.length}`;

      if (!isVideoShape(all) && all.length){
        $("grid").innerHTML = `
          <div class="warnBox">
            <strong>Your <code>/data/media.json</code> looks like a channel list, not a video list.</strong><br/>
            This page expects items where <code>id</code> is a YouTube <em>videoId</em> (so thumbnails + PTD summaries work).<br/>
            Fix: regenerate <code>data/media.json</code> from YouTube RSS videos (not channel URLs).
          </div>
        `;
        return;
      }

      $("grid").innerHTML = items.length
        ? items.map(cardHtml).join("")
        : `<div class="errorBox"><strong>No videos published today (UTC) matched your search.</strong></div>`;

      bindShareButtons();
    }

    async function load(){
      $("year").textContent = new Date().getFullYear();
      try{
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if(!res.ok) throw new Error(`Failed to load ${DATA_URL} (${res.status})`);
        const payload = await res.json();
        render(payload, $("q").value);
        $("q").addEventListener("input", ()=>render(payload, $("q").value));
      }catch(err){
        $("updatedLine").textContent = "Could not load Media.";
        $("grid").innerHTML = `
          <div class="errorBox">
            <strong>Media not available yet.</strong><br/>
            Expected file: <code>${escapeHtml(DATA_URL)}</code><br/>
            <div style="margin-top:10px;color:#6b665c;">${escapeHtml(err.message || String(err))}</div>
          </div>`;
      }
    }

    $("btnRefresh").addEventListener("click", ()=>location.reload());
    load();
  </script>
</body>
</html>