<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>PTD Today — Media</title>
  <meta name="description" content="PTD Today Media — curated YouTube videos with AI summaries for power transmission, substations, data centers, renewables, and critical minerals." />
  <link rel="canonical" href="https://ptdtoday.com/media.html" />

  <!-- Open Graph (Media) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="PTD Today" />
  <meta property="og:title" content="PTD Today — Media" />
  <meta property="og:description" content="Curated YouTube videos with AI summaries + PTD-style writeups." />
  <meta property="og:url" content="https://ptdtoday.com/media.html" />
  <meta property="og:image" content="https://ptdtoday.com/assets/og-default.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="PTD Today — Media" />
  <meta name="twitter:description" content="Curated YouTube videos with AI summaries + PTD-style writeups." />
  <meta name="twitter:image" content="https://ptdtoday.com/assets/og-default.png" />

  <style>
    :root{
      --bg:#ffffff;
      --paper:#ffffff;
      --ink:#111111;
      --muted:#5c5c5c;
      --rule:rgba(0,0,0,.15);
      --soft:rgba(0,0,0,.06);
      --pill:rgba(0,0,0,.04);
      --btn:#111;
      --btnInk:#fff;
      --card:#fff;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family: Georgia, "Times New Roman", Times, serif;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    a{color:inherit}

    .wrap{max-width:980px;margin:0 auto;padding:26px 16px 60px}

    .mast{text-align:center;padding:16px 0 6px}
    .brand{
      margin:0;
      font-size:52px;
      letter-spacing:.2px;
      font-weight:700;
      text-decoration:none;
      display:inline-block;
    }
    .tagline{margin:6px 0 10px;color:var(--muted);font-style:italic;font-size:16px}

    .nav{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin:10px 0 10px}
    .nav a{
      text-decoration:none;
      padding:7px 12px;
      border-radius:999px;
      border:1px solid transparent;
      color:rgba(0,0,0,.75);
      font-size:15px;
    }
    .nav a:hover{border-color:var(--rule);background:rgba(0,0,0,.02)}
    .nav a.active{border-color:var(--rule);background:rgba(0,0,0,.03);font-weight:700;color:rgba(0,0,0,.92)}

    .rule{height:1px;background:var(--rule);margin:14px 0 0}

    .pageTitle{
      text-align:center;
      margin:18px 0 2px;
      font-size:44px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .updated{text-align:center;color:var(--muted);font-size:15px;margin:6px 0 18px}

    .panel{
      background:var(--paper);
      border:1px solid var(--rule);
      border-radius:14px;
      overflow:hidden;
    }

    .toolbar{
      display:flex;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--rule);
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:1px solid var(--rule);
      background:var(--btn);
      color:var(--btnInk);
      padding:9px 14px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:14px;
    }
    .btn:hover{filter:brightness(.98)}

    .search{flex:1 1 320px;display:flex;align-items:center;margin-left:auto}
    .search input{
      width:100%;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:#fff;
      font-family:inherit;
      font-size:14px;
      outline:none;
    }

    .notice{
      padding:12px 14px;
      border-bottom:1px solid var(--rule);
      color:rgba(0,0,0,.80);
      font-size:14px;
      background:rgba(0,0,0,.02);
    }

    .headRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 14px;
      border-bottom:1px solid var(--rule);
      background:#fff;
      align-items:center;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:var(--pill);
      font-size:13px;
      color:rgba(0,0,0,.78);
    }
    .tiny{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1fr}

    .card{
      padding:16px 14px;
      border-bottom:1px solid var(--soft);
      background:var(--card);
    }
    .card:last-child{border-bottom:none}

    .meta{
      color:var(--muted);
      font-size:12px;
      letter-spacing:.14px;
      text-transform:uppercase;
      margin-bottom:8px;
    }

    .row{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:14px;
      align-items:start;
    }
    .thumb{
      width:100%;
      border-radius:12px;
      overflow:hidden;
      border:1px solid var(--rule);
      background:#f4f4f4;
      position:relative;
      display:block;
      text-decoration:none;
    }
    .thumb img{width:100%;height:auto;display:block}
    .play{
      position:absolute;
      right:10px;
      bottom:10px;
      background:rgba(0,0,0,.78);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      letter-spacing:.1px;
    }

    h2{margin:0 0 10px;font-size:28px;line-height:1.1;font-weight:900}
    .summary{margin:0 0 12px;font-size:16px;line-height:1.6;color:rgba(0,0,0,.86)}

    .subhead{
      margin:12px 0 6px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12px;
      color:var(--muted);
    }
    ul{margin:0 0 10px;padding-left:18px}
    li{margin:6px 0;line-height:1.35}

    .cta{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .btnMini{
      appearance:none;
      border:1px solid var(--rule);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-family:inherit;
      font-size:13px;
      color:#111;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      line-height:1;
    }
    .btnMini.primary{background:#111;color:#fff;border-color:#111}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      display:inline-flex;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--rule);
      background:rgba(0,0,0,.02);
      font-size:12px;
      color:rgba(0,0,0,.76);
    }

    .errorBox{
      padding:18px;
      margin:14px;
      border:1px solid rgba(150,0,0,.18);
      border-radius:12px;
      background:rgba(255,230,230,.55);
      color:#7a1f1f;
    }

    .footer{text-align:center;margin-top:18px;color:var(--muted);font-size:13px}

    /* Always-visible debug overlay (only shows on errors) */
    #debugOverlay{
      display:none;
      position:fixed;
      left:12px; right:12px; bottom:12px;
      z-index:999999;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(150,0,0,.25);
      background:rgba(255,240,240,.98);
      color:#7a1f1f;
      font-size:13px;
      line-height:1.35;
      box-shadow:0 10px 30px rgba(0,0,0,.12);
      white-space:pre-wrap;
      word-break:break-word;
    }

    @media (max-width:820px){
      .brand{font-size:44px}
      .pageTitle{font-size:36px}
      .row{grid-template-columns:1fr}
      h2{font-size:24px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="mast">
      <a class="brand" href="/" aria-label="PTD Today home">PTD Today</a>
      <div class="tagline">First to Know. First to Lead.</div>

      <nav class="nav" aria-label="Primary navigation">
        <a href="/index.html">Home</a>
        <a href="/room.html">Room</a>
        <a class="active" href="/media.html">Media</a>
      </nav>

      <div class="rule"></div>
    </header>

    <h1 class="pageTitle">Media</h1>
    <div class="updated" id="updatedLine">Loading…</div>

    <section class="panel" aria-label="Media videos">
      <div class="toolbar">
        <button class="btn" id="btnRefresh" type="button">Refresh</button>
        <div class="search">
          <input id="q" type="search" placeholder="Search videos, channels, topics…" autocomplete="off" />
        </div>
      </div>

      <div class="notice" id="disclaimerLine">
        Informational only — AI-generated summaries; may contain errors. Verify with the original video.
      </div>

      <div class="headRow">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <span class="pill" id="countPill">Items: —</span>
          <span class="pill" id="datePill">UTC Today: —</span>
        </div>
        <div class="tiny">Today-only feed</div>
      </div>

      <div class="grid" id="grid">
        <div class="errorBox"><strong>Loading…</strong><br/>If this stays, /data/media.json may be missing.</div>
      </div>
    </section>

    <div class="footer">© <span id="year"></span> PTD Today</div>
  </div>

  <div id="debugOverlay"></div>

  <script>
  (function () {
    var DATA_URL = "/data/media.json";

    function $(id) { return document.getElementById(id); }
    function escapeHtml(str) {
      return (str == null ? "" : String(str))
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }
    function fmtUtc(iso) {
      try { return new Date(iso).toUTCString().replace("GMT","UTC"); }
      catch (e) { return iso || ""; }
    }
    function normalize(s){ return (s || "").toString().toLowerCase(); }
    function mediaArticleUrl(videoId){
      return window.location.origin + "/media/" + encodeURIComponent(videoId) + ".html";
    }

    function showDebug(msg){
      var box = $("debugOverlay");
      if (!box) return;
      box.style.display = "block";
      box.textContent = msg;
    }

    window.addEventListener("error", function(e){
      showDebug("JS error: " + (e && e.message ? e.message : "unknown") + (e && e.filename ? ("\n" + e.filename + ":" + e.lineno) : ""));
    });
    window.addEventListener("unhandledrejection", function(e){
      showDebug("Promise error: " + (e && e.reason ? String(e.reason) : "unknown"));
    });

    function applyTodayOnly(items){
      // keep items whose published_at date matches UTC today (YYYY-MM-DD)
      var today = new Date().toISOString().slice(0,10);
      return (items || []).filter(function(v){
        var p = v && v.published_at ? String(v.published_at) : "";
        if (!p) return false;
        var d = p.slice(0,10); // works for ISO or YYYY-MM-DD
        return d === today;
      });
    }

    function applySearch(items, q){
      q = normalize(q).trim();
      if(!q) return items;
      return items.filter(function(v){
        var parts = [];
        parts.push(v && v.title ? v.title : "");
        parts.push(v && v.channel ? v.channel : "");
        var ai = v && v.ai ? v.ai : null;
        if(ai && ai.summary) parts.push(ai.summary);
        if(ai && Array.isArray(ai.bullets)) parts = parts.concat(ai.bullets);
        if(ai && Array.isArray(ai.takeaways)) parts = parts.concat(ai.takeaways);
        if(ai && Array.isArray(ai.tags)) parts = parts.concat(ai.tags);
        return normalize(parts.join(" ")).indexOf(q) !== -1;
      });
    }

    function cardHtml(v){
      var id = (v && v.id ? String(v.id) : "").trim();
      var title = v && v.title ? String(v.title) : "Untitled";
      var channel = v && v.channel ? String(v.channel) : "YouTube";
      var published = v && v.published_at ? String(v.published_at) : "";
      var url = v && v.url ? String(v.url) : "";
      var thumb = v && v.thumbnail ? String(v.thumbnail) : "";
      if(!thumb) thumb = window.location.origin + "/assets/og-default.png";

      var ai = v && v.ai ? v.ai : {};
      var summary = ai && ai.summary ? String(ai.summary) : "";
      var bullets = ai && Array.isArray(ai.bullets) ? ai.bullets : [];
      var takeaways = ai && Array.isArray(ai.takeaways) ? ai.takeaways : [];
      var tags = ai && Array.isArray(ai.tags) ? ai.tags : [];

      var meta = ["VIDEO", channel, published ? fmtUtc(published) : ""].filter(Boolean).join(" • ");
      var ptdUrl = mediaArticleUrl(id);

      return ''
        + '<article class="card">'
        +   '<div class="meta">' + escapeHtml(meta) + '</div>'
        +   '<div class="row">'
        +     '<a class="thumb" href="' + escapeHtml(url) + '" target="_blank" rel="noopener">'
        +       '<img loading="lazy" src="' + escapeHtml(thumb) + '" alt="">'
        +       '<span class="play">▶ Watch</span>'
        +     '</a>'
        +     '<div>'
        +       '<h2>' + escapeHtml(title) + '</h2>'
        +       (summary ? '<p class="summary">' + escapeHtml(summary) + '</p>' : '')
        +       (bullets.length ? (
                '<div class="subhead">Key points</div>'
              + '<ul>' + bullets.slice(0,5).map(function(b){ return '<li>' + escapeHtml(b) + '</li>'; }).join("") + '</ul>'
            ) : '')
        +       (takeaways.length ? (
                '<div class="subhead">So what</div>'
              + '<ul>' + takeaways.slice(0,4).map(function(t){ return '<li>' + escapeHtml(t) + '</li>'; }).join("") + '</ul>'
            ) : '')
        +       (tags.length ? (
                '<div class="chips">'
              + tags.slice(0,10).map(function(t){ return '<span class="chip">' + escapeHtml(t) + '</span>'; }).join("")
              + '</div>'
            ) : '')
        +       '<div class="cta">'
        +         '<a class="btnMini primary" href="' + escapeHtml(ptdUrl) + '" target="_blank" rel="noopener">Open PTD Summary</a>'
        +         '<a class="btnMini" href="' + escapeHtml(url) + '" target="_blank" rel="noopener">YouTube</a>'
        +       '</div>'
        +     '</div>'
        +   '</div>'
        + '</article>';
    }

    function showError(msg){
      if ($("updatedLine")) $("updatedLine").textContent = "Could not load Media.";
      if ($("grid")) {
        $("grid").innerHTML =
          '<div class="errorBox">'
        +   '<strong>Media not available yet.</strong><br/>'
        +   'Expected file: <code>' + escapeHtml(DATA_URL) + '</code><br/>'
        +   '<div style="margin-top:10px;color:#6b665c;">' + escapeHtml(msg) + '</div>'
        + '</div>';
      }
      showDebug("Load error: " + msg);
    }

    function render(payload){
      var updatedAt = payload && payload.updated_at ? payload.updated_at : "";
      if ($("updatedLine")) $("updatedLine").textContent = updatedAt ? ("Updated — " + fmtUtc(updatedAt)) : "Updated —";

      var disclaimer = payload && payload.disclaimer ? payload.disclaimer :
        "Informational only — AI-generated summaries; may contain errors. Verify with the original video.";
      if ($("disclaimerLine")) $("disclaimerLine").textContent = disclaimer;

      var utcToday = new Date().toISOString().slice(0,10) + " (UTC)";
      if ($("datePill")) $("datePill").textContent = "UTC Today: " + utcToday;

      var all = (payload && Array.isArray(payload.items)) ? payload.items : [];
      var todayItems = applyTodayOnly(all);
      var filtered = applySearch(todayItems, $("q") ? $("q").value : "");

      if ($("countPill")) $("countPill").textContent = "Items: " + filtered.length;

      if ($("grid")) {
        $("grid").innerHTML = filtered.length
          ? filtered.map(cardHtml).join("")
          : '<div class="errorBox"><strong>No videos found for today (UTC).</strong><br/>Your generator may be creating older items, or the selected channels did not publish today.</div>';
      }
    }

    var watchdog = setTimeout(function(){
      showError("Timeout fetching " + DATA_URL + ". Try opening " + DATA_URL + " directly to see if it exists.");
    }, 7000);

    function load(){
      if ($("year")) $("year").textContent = String(new Date().getFullYear());

      fetch(DATA_URL, { cache:"no-store" })
        .then(function(res){
          if (!res.ok) throw new Error("HTTP " + res.status + " for " + DATA_URL);
          return res.json();
        })
        .then(function(payload){
          clearTimeout(watchdog);
          render(payload);
          if ($("q")) $("q").addEventListener("input", function(){ render(payload); });
        })
        .catch(function(err){
          clearTimeout(watchdog);
          showError(err && err.message ? err.message : String(err));
        });
    }

    if ($("btnRefresh")) $("btnRefresh").addEventListener("click", function(){ location.reload(); });

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", load);
    } else {
      load();
    }
  })();
  </script>
</body>
</html>