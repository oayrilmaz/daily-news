<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PTD Today — Daily Energy & Power News</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' rx='42' fill='%23d9cfbc'/%3E%3Ctext x='50%' y='58%' font-family='Georgia,serif' font-size='128' text-anchor='middle' fill='%23331'%3EPTD%3C/text%3E%3C/svg%3E">
<meta property="og:title" content="PTD Today — Daily Energy & Power News">
<meta property="og:description" content="First to Know. First to Lead.">
<meta property="og:image" content="https://ptdtoday.com/assets/og-default.png">
<meta property="twitter:card" content="summary_large_image">
<style>
  :root{
    --bg:#e8dfcf;--ink:#231f1a;--muted:#6b6054;--badge:#e0d6c5;--pill:#efe6d6;
    --link:#0b2c8a;--pill-ink:#2c241b;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);}
  body{font-family:Georgia,serif;line-height:1.5;}
  .container{max-width:920px;margin:0 auto;padding:16px 14px 48px;}
  h1{font-size:56px;margin:24px 0 0;letter-spacing:.5px}
  .tag{margin:6px 0 24px;color:var(--muted);font-style:italic}
  h2{margin:10px 0 18px;font-size:26px;letter-spacing:.3px}
  .tabs{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0 6px}
  .tab{border-radius:24px;background:var(--pill);color:var(--pill-ink);padding:8px 14px;cursor:pointer;border:1px solid #d1c6b3;font-weight:700}
  .tab.active{background:#fff;border-color:#c9bda7}
  .stamp{display:inline-block;margin:10px 0 16px;background:#fff;border-radius:999px;border:1px solid #d1c6b3;padding:8px 14px;color:var(--muted);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .card{display:grid;grid-template-columns:120px 1fr;gap:16px;background:#fff;border:1px solid #d8cdbb;border-radius:8px;padding:14px;margin:18px 0}
  .thumb{width:120px;height:90px;object-fit:cover;border-radius:6px;background:#f0eadf;border:1px solid #e5dac7}
  .cat{font-size:12px;letter-spacing:.12em;color:var(--muted);text-transform:uppercase;margin-bottom:6px}
  .title{font-size:26px;line-height:1.25;margin:0}
  .title a{color:var(--link);text-decoration:none}
  .meta{color:var(--muted);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;font-size:14px;margin-top:6px}
  .btns{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
  .btn{border-radius:999px;padding:8px 14px;border:1px solid #d1c6b3;background:#fff;cursor:pointer}
  .sr{position:absolute;left:-9999px}
</style>
</head>
<body>
  <div class="container">
    <h1>PTD Today</h1>
    <div class="tag">First to Know. First to Lead.</div>
    <h2>Daily Energy &amp; Power News</h2>

    <nav class="tabs" id="tabs">
      <!-- order matters for UX -->
      <button class="tab active" data-cat="all">All</button>
      <button class="tab" data-cat="top">Top (7d)</button>
      <button class="tab" data-cat="grid">Grid</button>
      <button class="tab" data-cat="substations">Substations</button>
      <button class="tab" data-cat="protection">Protection</button>
      <button class="tab" data-cat="cables">Cables</button>
      <button class="tab" data-cat="hvdc">HVDC</button>
      <button class="tab" data-cat="renewables">Renewables</button>
      <button class="tab" data-cat="policy">Policy</button>
      <!-- NEW tabs -->
      <button class="tab" data-cat="ai">AI</button>
      <button class="tab" data-cat="datacenters">Data Centers</button>
    </nav>

    <div class="stamp" id="updated">Updated — …</div>

    <main id="list" aria-live="polite"></main>

    <footer class="meta" style="margin-top:28px;">
      © 2025 PTD Today • Headlines link to their original publishers.
    </footer>
  </div>

<script>
const updated = document.getElementById('updated');
const list = document.getElementById('list');
const tabs = document.getElementById('tabs');

const DAY = 24*60*60*1000;

// windows (same logic we agreed)
function windows(now=new Date()){
  const d = new Date(Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()));
  const dow = d.getUTCDay(); // Sun=0
  let allFrom;
  if(dow===1){ allFrom = new Date(d.getTime()-3*DAY); } // Mon->Fri..Mon
  else if(dow===0){ allFrom = new Date(d.getTime()-2*DAY); } // Sun->Fri..Sun
  else { allFrom = new Date(d.getTime()-1*DAY); } // others->yesterday..now
  return {
    all:[allFrom, now],
    top:[new Date(now.getTime()-7*DAY), now]
  };
}

function within(win, iso){
  const t = new Date(iso);
  return t>=win[0] && t<=win[1];
}

// tiny guaranteed image (matches python default)
const PLACEHOLDER = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='120'%3E%3Crect width='100%25' height='100%25' fill='%23efe7d7'/%3E%3Cpath d='M15 90 L60 50 L85 72 L110 58 L145 90 Z' fill='%23d7c9b1'/%3E%3C/svg%3E";

function card(it){
  const div = document.createElement('article');
  div.className = 'card';
  const aOpen = `https://ptdtoday.com/s/${it.id}.html`;
  div.innerHTML = `
    <img class="thumb" src="${it.image || PLACEHOLDER}" alt="">
    <div>
      <div class="cat">${(it.category||'').toUpperCase()}</div>
      <h3 class="title"><a href="${aOpen}">${it.title}</a></h3>
      <div class="meta">${it.source||''}${it.source?' • ':''}${new Date(it.published).toISOString().replace('.000Z','Z')}${it.score!=null?' • Score: '+(+it.score).toFixed(3):''}</div>
      <div class="btns">
        <a class="btn" href="${aOpen}">Open on PTD Today</a>
        <a class="btn" href="${it.url}" rel="nofollow">Source</a>
        <button class="btn" onclick="share('${aOpen}','${it.title.replace(/'/g,'’')}')">Share</button>
      </div>
    </div>`;
  return div;
}

async function load(){
  const res = await fetch('/data/news.json',{cache:'no-store'});
  const data = await res.json();
  updated.textContent = 'Updated — ' + data.updated;
  const items = data.items||[];

  const now = new Date();
  const win = windows(now);

  // render function
  function render(cat){
    list.innerHTML = '';
    let rows = items.slice();
    if(cat==='top'){
      rows = rows.filter(it=>within(win.top,it.published));
    }else if(cat==='all'){
      rows = rows.filter(it=>within(win.all,it.published));
    }else{
      // category tab
      const want = (cat||'').toLowerCase();
      rows = rows.filter(it=>{
        const hit = (it.category||'').toLowerCase()===want;
        const inWindow = within(win.all,it.published) || within(win.top,it.published);
        return hit && inWindow;
      });
    }
    rows.forEach(it=>list.appendChild(card(it)));
    if(rows.length===0){
      const p=document.createElement('p');p.className='meta';p.textContent='No stories found.';list.appendChild(p);
    }
  }

  // initial
  render('all');

  tabs.addEventListener('click', (e)=>{
    const b = e.target.closest('.tab');
    if(!b) return;
    tabs.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t===b));
    render(b.dataset.cat);
  });
}

function share(url,title){
  if(navigator.share){
    navigator.share({title, url}).catch(()=>{});
  }else{
    navigator.clipboard.writeText(url);
    alert('Link copied: '+url);
  }
}

load();
</script>
</body>
</html>