<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PTD Today — Daily Energy & Power News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2212%22>⚡</text></svg>">
<style>
  :root{--ink:#1a1a1a;--muted:#666;--rule:#e8e8e8;}
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff}
  .wrap{max-width:980px;margin:0 auto;padding:24px}
  h1{font-weight:800;letter-spacing:.3px;font-size:44px;margin:8px 0 4px}
  .motto{color:var(--muted);margin:0 0 20px;font-weight:500}
  .subtitle{font-weight:800;font-size:26px;margin:0 0 16px}
  .tabs{display:flex;gap:18px;border-bottom:1px solid var(--rule);padding:10px 0 12px;margin-bottom:12px;flex-wrap:wrap}
  .tab{cursor:pointer;color:var(--muted);font-weight:700}
  .tab.active{color:var(--ink);text-decoration:underline;text-underline-offset:6px}
  .updated{margin:12px 0 8px;color:var(--muted);border:1px solid var(--rule);border-radius:999px;display:inline-flex;align-items:center;padding:6px 12px;font-size:14px}
  .item{display:grid;grid-template-columns:160px 1fr;gap:16px;padding:18px 0;border-bottom:1px solid var(--rule)}
  .thumb{width:160px;height:100px;object-fit:cover;border-radius:6px;background:#f5f5f5}
  .title{font-weight:800;font-size:22px;margin:0 0 4px}
  .title a{color:#2a00b8;text-decoration:none}
  .title a:hover{text-decoration:underline}
  .meta{color:var(--muted);font-size:14px;margin:6px 0 10px}
  .btns{display:flex;gap:8px;flex-wrap:wrap}
  .btn{border:1px solid var(--rule);padding:8px 12px;border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
  .btn:hover{background:#fafafa}
  .score{color:#8a8a8a;border:1px dashed #dedede}
  .empty{padding:28px 0;color:var(--muted)}
  /* share dialog */
  dialog{border:none;border-radius:14px;max-width:420px;width:92vw;padding:0;box-shadow:0 20px 60px rgba(0,0,0,.15)}
  .sheet{padding:10px}
  .sheet h3{margin:10px 14px 6px;font-size:16px}
  .share-list{display:flex;flex-direction:column;padding:8px}
  .share-list a,.share-list button{appearance:none;border:0;background:#fff;border-top:1px solid var(--rule);padding:14px 12px;text-align:left;font-weight:700}
  .share-list a:hover,.share-list button:hover{background:#fafafa}
  .close-row{border-top:1px solid var(--rule);padding:10px;text-align:right}
  .close-row button{border:1px solid var(--rule);background:#fff;border-radius:10px;padding:8px 12px;font-weight:700}
  footer{margin:24px 0 8px;color:#777;text-align:center;border-top:1px solid var(--rule);padding-top:14px}
  @media (max-width:720px){ .item{grid-template-columns:1fr} .thumb{width:100%;height:180px}}
</style>
</head>
<body>
<div class="wrap">
  <h1>PTD Today</h1>
  <p class="motto">First to Know. First to Lead.</p>
  <h2 class="subtitle">Daily Energy &amp; Power News</h2>

  <div class="tabs" id="tabs">
    <span class="tab active" data-cat="all">All</span>
    <span class="tab" data-cat="top">Top (7d)</span>
    <span class="tab" data-cat="grid">Grid</span>
    <span class="tab" data-cat="substations">Substations</span>
    <span class="tab" data-cat="protection">Protection</span>
    <span class="tab" data-cat="cables">Cables</span>
    <span class="tab" data-cat="hvdc">HVDC</span>
    <span class="tab" data-cat="renewables">Renewables</span>
    <span class="tab" data-cat="policy">Policy</span>
  </div>

  <div class="updated" id="updated">Updated —</div>

  <div id="list" class="list"></div>

  <footer>© 2025 PTD Today • Headlines link to their original publishers.</footer>
</div>

<!-- Share Dialog -->
<dialog id="shareDialog">
  <div class="sheet">
    <h3>Share this story</h3>
    <div class="share-list">
      <a id="lnShare" target="_blank" rel="noopener">LinkedIn</a>
      <a id="xShare"  target="_blank" rel="noopener">X (Twitter)</a>
      <a id="fbShare" target="_blank" rel="noopener">Facebook</a>
      <a id="rdShare" target="_blank" rel="noopener">Reddit</a>
      <button id="cpShare">Copy link</button>
      <a id="emShare">Email</a>
    </div>
    <div class="close-row"><button id="closeShare">Close ×</button></div>
  </div>
</dialog>

<script>
(() => {
  const listEl = document.getElementById('list');
  const updatedEl = document.getElementById('updated');
  const tabsEl = document.getElementById('tabs');

  let ITEMS = [];

  const errorMsg = (txt) => {
    listEl.innerHTML = `<div class="empty">${txt}<br><br>
      Tip: ensure <code>/data/news.json</code> exists and contains <code>{ updated, items:[...] }</code>.
    </div>`;
  };

  const fmtHost = (u) => { try{ return new URL(u).host.replace(/^www\./,''); } catch { return ''; } };

  function articleUrl(item){
    const u = new URL('/article.html', location.origin);
    u.searchParams.set('u', item.url);
    if(item.title) u.searchParams.set('t', item.title);
    if(item.image) u.searchParams.set('i', item.image);
    return u.toString();
  }

  function renderItem(item){
    const el = document.createElement('div');
    el.className = 'item';
    const img = item.image || 'https://picsum.photos/seed/ptd-default/1200/630';
    el.innerHTML = `
      <img class="thumb" src="${img}" alt="">
      <div>
        <h3 class="title"><a href="${articleUrl(item)}">${item.title}</a></h3>
        <div class="meta">${fmtHost(item.url)} · <span>${(item.cats||[]).join(' • ')}</span></div>
        <div class="meta">${item.summary||''}</div>
        <div class="btns">
          <a class="btn" href="${articleUrl(item)}">Open on PTD Today</a>
          <a class="btn" href="${item.url}" target="_blank" rel="noopener">Source</a>
          <button class="btn shareBtn">Share</button>
          <span class="btn score">Score: ${item.score?.toFixed?.(2) ?? '3.80'}</span>
        </div>
      </div>`;
    el.querySelector('.shareBtn').addEventListener('click', () => openShare(item));
    return el;
  }

  // Share dialog wiring
  const dlg = document.getElementById('shareDialog');
  const ln = document.getElementById('lnShare');
  const x  = document.getElementById('xShare');
  const fb = document.getElementById('fbShare');
  const rd = document.getElementById('rdShare');
  const cp = document.getElementById('cpShare');
  const em = document.getElementById('emShare');
  document.getElementById('closeShare').onclick = () => dlg.close();

  function openShare(item){
    const ptd = articleUrl(item);
    const encT = encodeURIComponent(item.title||'');
    const encU = encodeURIComponent(ptd);

    ln.href = `https://www.linkedin.com/sharing/share-offsite/?url=${encU}`;
    x.href  = `https://twitter.com/intent/tweet?url=${encU}&text=${encT}`;
    fb.href = `https://www.facebook.com/sharer/sharer.php?u=${encU}`;
    rd.href = `https://www.reddit.com/submit?url=${encU}&title=${encT}`;
    em.href = `mailto:?subject=${encT}&body=${encU}`;
    cp.onclick = async () => {
      try{ await navigator.clipboard.writeText(ptd); alert('Link copied: ' + ptd); }
      catch{ prompt('Copy link:', ptd); }
    };
    dlg.showModal();
  }

  function applyTab(cat){
    [...tabsEl.querySelectorAll('.tab')].forEach(t => t.classList.toggle('active', t.dataset.cat === cat));
    let arr = ITEMS;
    if(cat === 'top'){
      // naive “top (7d)” filter - here we just pick top scores
      arr = [...ITEMS].sort((a,b) => (b.score||0) - (a.score||0)).slice(0, 20);
    } else if(cat !== 'all'){
      arr = ITEMS.filter(n => (n.cats||[]).includes(cat));
    }
    listEl.innerHTML = '';
    if(!arr.length){ listEl.innerHTML = '<div class="empty">No stories in this category yet.</div>'; return; }
    arr.forEach(n => listEl.appendChild(renderItem(n)));
  }

  tabsEl.addEventListener('click', (e) => {
    const t = e.target.closest('.tab'); if(!t) return;
    applyTab(t.dataset.cat);
  });

  async function load(){
    try{
      const res = await fetch('/data/news.json?v=' + Date.now());
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      updatedEl.textContent = 'Updated — ' + (data.updated || '');
      ITEMS = data.items || [];
      if(!ITEMS.length){ errorMsg('No stories found.'); return; }
      applyTab('all');
    }catch(err){
      errorMsg('Could not load /data/news.json (' + err.message + ').');
    }
  }

  load();
})();
</script>
</body>
</html>