<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTD Today | Power Transmission & Distribution Daily News</title>
  <meta name="description" content="PTD Today delivers the latest headlines, insights, and updates across power transmission & distribution, HV substations, grid modernization, and energy technology." />
  <meta name="theme-color" content="#ffffff" />
  <meta property="og:title" content="PTD Today | Power Transmission & Distribution Daily News" />
  <meta property="og:description" content="Daily and near real-time headlines across T&D, HV substations, grid modernization, and energy technology." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://ptdtoday.com/" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext x='50%25' y='55%25' text-anchor='middle' font-size='36' font-family='Georgia,serif'%3EPTD%3C/text%3E%3C/svg%3E">

  <style>
    :root{--ink:#111;--ink-2:#333;--ink-3:#555;--line:#e5e5e5;--bg:#fff;--maxw:1150px;}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Helvetica Neue",Arial,system-ui,sans-serif;line-height:1.5;}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 16px;}
    .serif{font-family:Georgia,"Times New Roman",serif;}
    header{border-bottom:1px solid var(--line);padding:18px 0 10px;}
    .topbar{display:flex;align-items:center;justify-content:space-between;}
    .brand{display:flex;align-items:center;gap:14px;}
    .brand-mark{width:44px;height:44px;border:2px solid var(--ink);border-radius:50%;display:grid;place-items:center;font-weight:700;font-family:Georgia,serif;}
    .brand-title{font-size:34px;font-weight:700;color:var(--ink);font-family:Georgia,serif;}
    .brand-sub{font-size:13px;color:var(--ink-3);margin-top:2px;}
    .sponsor-mini{display:flex;align-items:center;gap:10px;}
    .pill{width:40px;height:40px;border:1.5px solid var(--ink);border-radius:50%;display:grid;place-items:center;font-weight:700;font-family:Georgia,serif;}
    .sponsor-line{font-size:12px;color:var(--ink-3);text-align:right;}
    nav{border-top:1px solid var(--line);border-bottom:1px solid var(--line);padding:8px 0;margin-top:10px;font-size:13px;color:var(--ink-2);}
    nav .row{display:flex;gap:14px;flex-wrap:wrap;}
    nav a{color:inherit;text-decoration:none;}
    nav a:hover{text-decoration:underline;}
    .chip{font-size:11px;border:1px solid var(--line);padding:2px 6px;border-radius:10px;color:var(--ink-3);}
    button.min{border:1px solid var(--line);background:#fafafa;color:var(--ink);font-size:12px;padding:6px 10px;border-radius:6px;cursor:pointer}
    button.min:hover{background:#f2f2f2}
    .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:6px 0 0;}

    .grid{display:grid;gap:22px;grid-template-columns:1.6fr 1fr;padding:20px 0 28px;}
    .lead{border-right:1px solid var(--line);padding-right:22px;}
    .lead h1{font-size:40px;line-height:1.1;margin:8px 0;font-weight:700;}
    .lead .dek{font-size:17px;color:var(--ink-2);margin-bottom:14px;font-family:Georgia,serif;}
    .meta{font-size:12px;color:var(--ink-3);margin-bottom:16px;}
    .lead img{width:100%;border:1px solid var(--line);}
    .cards{display:grid;gap:18px;grid-template-columns:1fr 1fr;}
    .card{border-top:1px solid var(--line);padding-top:12px;}
    .card h3{font-family:Georgia,serif;font-size:20px;line-height:1.18;margin:6px 0;}
    .card p{font-size:14px;color:var(--ink-2);margin:6px 0 8px;}
    .card a{color:var(--ink);text-decoration:none;}
    .card a:hover{text-decoration:underline;}
    .card .row{display:flex;gap:8px;align-items:center;margin-top:6px;flex-wrap:wrap}

    .sidebar section{border-bottom:1px solid var(--line);padding-bottom:14px;margin-bottom:14px;}
    .sidebar h4{font-family:Georgia,serif;margin:0 0 8px;font-size:18px;}
    .list{list-style:none;margin:0;padding:0;font-size:14px;}
    .list li{padding:8px 0;border-top:1px solid var(--line);}
    footer{border-top:1px solid var(--line);padding:18px 0 40px;font-size:12px;color:var(--ink-3);}
    @media (max-width:900px){.grid{grid-template-columns:1fr}.lead{border-right:none;padding-right:0}.cards{grid-template-columns:1fr}.brand-title{font-size:28px}}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="brand-mark">PTD</div>
        <div>
          <div class="brand-title serif">PTD Today</div>
          <div class="brand-sub">Power Transmission &amp; Distribution Daily News</div>
        </div>
      </div>
      <div>
        <div class="sponsor-mini"><div class="pill">S1</div><div class="pill">S2</div></div>
        <div class="sponsor-line">Sponsored content</div>
      </div>
    </div>
    <nav>
      <div class="row">
        <a href="#">Grid &amp; HV</a><a href="#">Substations</a><a href="#">Protection</a><a href="#">Switchgear</a>
        <a href="#">Cables</a><a href="#">Renewables</a><a href="#">Data Centers</a><a href="#">Policy &amp; Tariffs</a><a href="#">Jobs</a>
        <span class="tools">
          <button class="min" id="refreshNow">Refresh Now</button>
          <span class="chip" id="lastUpdated">Updated: —</span>
          <span class="chip">Auto: 3h</span>
        </span>
      </div>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <div class="lead">
      <article id="lead">
        <div class="meta serif">Top Story</div>
        <h1 class="serif" id="leadTitle">Latest in Transmission &amp; Distribution</h1>
        <p class="dek" id="leadDek">Daily coverage of grid projects, HV substations, cable systems, protection &amp; control, and energy policy.</p>
        <img id="leadImg" alt="Lead image" src="https://placehold.co/1200x650/png?text=PTD+Today" />
        <div class="meta" id="leadMeta">Published —</div>
      </article>

      <section style="margin-top:22px">
        <div class="cards" id="storyGrid"></div>
      </section>
    </div>

    <aside class="sidebar">
      <section>
        <h4>Most Read</h4>
        <ol class="list" id="mostRead"></ol>
      </section>
      <section>
        <h4>Quick Filters</h4>
        <div class="tools">
          <button class="min" data-filter="grid">Grid</button>
          <button class="min" data-filter="substation">Substations</button>
          <button class="min" data-filter="protection">Protection</button>
          <button class="min" data-filter="cable">Cables</button>
          <button class="min" data-filter="policy">Policy</button>
          <button class="min" data-filter="datacenter">Data Centers</button>
          <button class="min" data-filter="renewable">Renewables</button>
          <button class="min" id="clearFilter">All</button>
        </div>
      </section>
      <section>
        <h4>About</h4>
        <p class="muted">PTD Today delivers concise coverage across Power T&amp;D — refreshed daily (and every 3 hours).</p>
      </section>
    </aside>
  </div>
</main>

<footer>
  <div class="wrap">
    <div>© 2025 PTD Today. All rights reserved.</div>
    <div class="muted">Headlines sourced from public publisher RSS feeds; links open to original sources.</div>
  </div>
</footer>

<script>
  const FEEDS = [
    "https://www.tdworld.com/rss",
    "https://www.utilitydive.com/feeds/news/",
    "https://feeds.reuters.com/reuters/energy",
    "https://www.powermag.com/feed/",
    "https://www.ieee-pes.org/feed/"
  ];
  const state = { filter:null, items:[] };
  let shortMap = {}; // originalLink -> slug

  const el = (id)=>document.getElementById(id);

  function timeAgo(date){ const d=new Date(date); if(isNaN(d)) return ""; const diff=(Date.now()-d)/1000;
    if(diff<60) return "just now"; const m=Math.floor(diff/60); if(m<60) return m+" min ago";
    const h=Math.floor(m/60); if(h<24) return h+" h ago"; const days=Math.floor(h/24); return days+" d ago"; }
  function strip(html){ const tmp=document.createElement("div"); tmp.innerHTML=html; return tmp.textContent||tmp.innerText||""; }
  function escapeHTML(s){ return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m])); }

  async function loadShortMap(){
    try{
      const r = await fetch("/data/shortlinks.json", {cache:"no-store"});
      if (r.ok) shortMap = await r.json();
    }catch(e){}
  }

  async function fetchRSS(url){
    const prox="https://api.allorigins.win/raw?url="+encodeURIComponent(url);
    const res=await fetch(prox); if(!res.ok) throw new Error("feed error");
    const text=await res.text(); const xml=new DOMParser().parseFromString(text,"text/xml");
    const items=[...xml.querySelectorAll("item")].map(item=>{
      const title=item.querySelector("title")?.textContent?.trim()||"";
      const link=item.querySelector("link")?.textContent?.trim()||"#";
      const pubDate=item.querySelector("pubDate")?.textContent||"";
      const desc=item.querySelector("description")?.textContent||"";
      const content=item.querySelector("content\\:encoded")?.textContent||"";
      const imgMatch=(content||desc).match(/<img[^>]+src=["']([^"']+)["']/i);
      const img=imgMatch?imgMatch[1]:null;
      const k=(title+" "+desc).toLowerCase();
      let tag="grid";
      if(k.includes("substation")||k.includes("switchgear")) tag="substation";
      else if(k.includes("relay")||k.includes("protection")||k.includes("iec")) tag="protection";
      else if(k.includes("cable")||k.includes("hvdc")||k.includes("xlpe")) tag="cable";
      else if(k.includes("policy")||k.includes("tariff")||k.includes("regulat")) tag="policy";
      else if(k.includes("data center")||k.includes("datacenter")) tag="datacenter";
      else if(k.includes("renewable")||k.includes("solar")||k.includes("wind")) tag="renewable";
      return {title,link,pubDate,desc,img,tag};
    });
    return items;
  }

  async function fetchAll(){
    const batches=await Promise.allSettled(FEEDS.map(fetchRSS));
    const items=[];
    for(const b of batches){ if(b.status==="fulfilled") items.push(...b.value); }
    items.sort((a,b)=>new Date(b.pubDate)-new Date(a.pubDate));
    state.items=items.slice(0,24);
    render();
    el("lastUpdated").textContent="Updated: "+new Date().toLocaleString();
  }

  function internalArticleURL(it){
    const t=encodeURIComponent(it.title||"");
    const u=encodeURIComponent(it.link||"#");
    const d=encodeURIComponent(strip(it.desc||"").slice(0,280));
    const i=encodeURIComponent(it.img||"");
    const g=encodeURIComponent(it.tag||"news");
    const p=encodeURIComponent(it.pubDate||"");
    return `/article.html?t=${t}&u=${u}&d=${d}&i=${i}&g=${g}&p=${p}`;
  }
  function shortShareURL(it){
    const slug = shortMap[it.link];
    return slug ? `/s/${slug}.html` : internalArticleURL(it);
  }

  function render(){
    const filtered=state.filter?state.items.filter(i=>i.tag===state.filter):state.items;

    if(filtered[0]){
      const L=filtered[0];
      el("leadTitle").textContent=L.title||"PTD Today";
      el("leadDek").textContent=strip(L.desc).slice(0,180)||"Latest updates across power T&D.";
      el("leadImg").src=L.img||"https://placehold.co/1200x650/png?text=PTD+Today";
      el("leadMeta").textContent=(L.tag.toUpperCase())+" • "+(L.pubDate?timeAgo(L.pubDate):"");
      const internal=internalArticleURL(L);
      el("leadTitle").onclick=()=>location.href=internal;
      el("leadImg").onclick=()=>location.href=internal;
      el("lead").style.cursor="pointer";
    }

    const grid=el("storyGrid"); grid.innerHTML="";
    filtered.slice(1).forEach(it=>{
      const div=document.createElement("div"); div.className="card";
      const internal=internalArticleURL(it);
      div.innerHTML = `
        <a href="${internal}" rel="noopener">
          <h3>${escapeHTML(it.title)}</h3>
        </a>
        <p>${escapeHTML(strip(it.desc).slice(0,140))}</p>
        <div class="meta"><span class="chip">${it.tag}</span> · ${it.pubDate?timeAgo(it.pubDate):""}</div>
        <div class="row">
          <a class="min" href="${internal}">Open on PTD Today</a>
          <button class="min" type="button">Share</button>
          <a class="min" href="${it.link}" target="_blank" rel="noopener">Source</a>
        </div>
      `;
      const shareBtn=div.querySelector("button.min");
      shareBtn.addEventListener("click", ()=>{
        const share = location.origin + shortShareURL(it);
        const text  = strip(it.desc||"").slice(0,160);
        if(navigator.share){ navigator.share({title:it.title,text,url:share}).catch(()=>{}); }
        else{
          const url=encodeURIComponent(share);
          window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`,"_blank");
        }
      });
      div.querySelectorAll("a").forEach(a=>a.addEventListener("click", ()=>trackClick(it)));
      grid.appendChild(div);
    });
    renderMostRead();
  }

  function renderMostRead(){
    const box=el("mostRead"); const data=JSON.parse(localStorage.getItem("ptd_most")||"[]");
    data.sort((a,b)=>b.c-a.c); box.innerHTML="";
    data.slice(0,8).forEach(d=>{
      const internal=`/article.html?t=${encodeURIComponent(d.t)}&u=${encodeURIComponent(d.l)}`;
      const li=document.createElement("li");
      li.innerHTML=`<a href="${internal}">${escapeHTML(d.t)}</a><div class="meta">${d.c} reads</div>`;
      box.appendChild(li);
    });
  }
  function trackClick(item){
    const key="ptd_most"; const arr=JSON.parse(localStorage.getItem(key)||"[]");
    const i=arr.findIndex(x=>x.l===item.link); if(i>=0) arr[i].c+=1; else arr.push({t:item.title,l:item.link,c:1});
    localStorage.setItem(key, JSON.stringify(arr));
  }

  document.getElementById("refreshNow").addEventListener("click", fetchAll);
  document.querySelectorAll("[data-filter]").forEach(btn=>{
    btn.onclick=()=>{state.filter=btn.getAttribute("data-filter"); render();}
  });
  document.getElementById("clearFilter").onclick=()=>{state.filter=null; render();};

  loadShortMap().then(fetchAll);
  setInterval(fetchAll,10800000);
</script>
</body>
</html>
