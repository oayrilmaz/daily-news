<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTD Today — Daily Energy & Power News</title>

  <!-- OG/Twitter (homepage) -->
  <meta property="og:site_name" content="PTD Today">
  <meta property="og:title" content="PTD Today — Daily Energy & Power News">
  <meta property="og:description" content="First to Know. First to Lead. Curated headlines for power T&D, substations, protection & control, cables, HVDC, renewables and policy.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ptdtoday.com/">
  <meta property="og:image" content="https://ptdtoday.com/assets/og-default.png">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{ --ink:#0b0b0b; --ink2:#333; --ink3:#666; --line:#e6e6e6; --bg:#fff;
           --maxw:1000px; --img:200px; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink)}
    body{font-family:Georgia,'Times New Roman',Times,serif; line-height:1.5}
    header{border-bottom:1px solid var(--line); text-align:center; padding:28px 0 12px}
    .title{font-size:48px; font-weight:800; margin:0}
    .motto{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink3); font-size:14px; margin:4px 0 6px}
    .strap{font-size:22px; font-weight:700; margin:0}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 18px}

    nav{border-bottom:1px solid var(--line); padding:12px 0}
    .navRow{display:flex; align-items:center; gap:12px}
    .tabs{display:flex; gap:18px; flex-wrap:wrap; align-items:center; justify-content:center; margin:0 auto}
    .tab{font-size:16px; text-decoration:none; color:var(--ink2)}
    .tab[aria-current="true"]{color:var(--ink); font-weight:700}
    .stamp{margin-left:auto; font-size:12px; color:var(--ink3); border:1px solid var(--line); border-radius:18px; padding:4px 10px; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    main{padding:14px 0 48px}
    .feed{display:grid; gap:18px}
    .item{border-top:1px solid var(--line); padding-top:14px}
    .media{display:grid; grid-template-columns:var(--img) 1fr; gap:16px; align-items:start}
    .imgWrap{width:var(--img); height:var(--img); border:1px solid var(--line); overflow:hidden; background:#fff}
    .imgWrap img{width:100%; height:100%; object-fit:cover}
    h3{font-size:22px; margin:0 0 6px; line-height:1.16}
    .dek{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink2); font-size:14px; margin:6px 0 8px}
    .meta{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; font-size:12px; color:var(--ink3)}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .btn{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; border:1px solid var(--line); background:#fafafa; padding:7px 12px; border-radius:8px; cursor:pointer; font-size:13px; color:var(--ink); text-decoration:none}
    .btn:hover{background:#f2f2f2}
    footer{border-top:1px solid var(--line); color:var(--ink3); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; font-size:12px; padding:16px 0 36px}
    .floating{position:fixed; right:16px; bottom:16px; z-index:30}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1 class="title">PTD Today</h1>
    <div class="motto">First to Know. First to Lead.</div>
    <p class="strap">Daily Energy &amp; Power News</p>
  </div>
</header>

<nav>
  <div class="wrap navRow">
    <div class="tabs" id="tabs">
      <a href="#" class="tab" data-cat="All" aria-current="true">All</a>
      <a href="#" class="tab" data-cat="Grid">Grid</a>
      <a href="#" class="tab" data-cat="Substations">Substations</a>
      <a href="#" class="tab" data-cat="Protection">Protection</a>
      <a href="#" class="tab" data-cat="Cables">Cables</a>
      <a href="#" class="tab" data-cat="HVDC">HVDC</a>
      <a href="#" class="tab" data-cat="Renewables">Renewables</a>
      <a href="#" class="tab" data-cat="Policy">Policy</a>
    </div>
    <span class="stamp" id="updated">Updated —</span>
  </div>
</nav>

<main class="wrap">
  <section class="feed" id="feed"></section>
</main>

<footer>
  <div class="wrap">© 2025 PTD Today • Headlines link to their original publishers.</div>
</footer>

<div class="floating"><button id="refresh" class="btn" type="button">Refresh</button></div>

<script>
const FEED_EL = document.getElementById("feed");
const UPDATED_EL = document.getElementById("updated");
const TABS = document.getElementById("tabs");
let ALL = [];
let CAT = "All";
let BUILD_AT = null;

const esc = (s='') => s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
const relTime = (iso) => {
  if(!iso) return "";
  const t = new Date(iso), now = new Date();
  const diff = (now - t)/1000;
  if(diff < 60) return "just now";
  const m = Math.floor(diff/60); if(m<60) return `${m} min ago`;
  const h = Math.floor(m/60); if(h<24) return `${h} h ago`;
  return `${Math.floor(h/24)} d ago`;
};

function cardHTML(a){
  const img = a.image && a.image.trim() ? a.image : "assets/og-default.png";
  const internal = `article.html?u=${encodeURIComponent(a.url)}&t=${encodeURIComponent(a.title)}&d=${encodeURIComponent(a.summary||'')}&i=${encodeURIComponent(img)}&g=${encodeURIComponent(a.category||'')}&p=${encodeURIComponent(a.time||'')}`;
  const short = a.slug ? `${location.origin}/s/${a.slug}.html` : internal;

  return `
  <article class="item">
    <div class="media">
      <div class="imgWrap"><img src="${esc(img)}" alt=""></div>
      <div>
        <h3><a href="${internal}">${esc(a.title)}</a></h3>
        <div class="dek">${esc((a.summary||"").slice(0,220))}</div>
        <div class="meta">
          ${esc(a.category||"")} • Published ${esc(relTime(a.time))}
          ${BUILD_AT ? ` • Refreshed ${esc(relTime(BUILD_AT))}` : ""}
        </div>
        <div class="row">
          <a class="btn" href="${internal}">Open on PTD Today</a>
          <a class="btn" href="${a.url}" target="_blank" rel="noopener">Source</a>
          <button class="btn" onclick="shareURL('${encodeURIComponent(short)}','${esc(a.title)}')">Share</button>
        </div>
      </div>
    </div>
  </article>`;
}

function render(){
  const list = CAT==="All" ? ALL : ALL.filter(x => (x.category||"").toLowerCase() === CAT.toLowerCase());
  FEED_EL.innerHTML = list.map(cardHTML).join("");
  [...TABS.querySelectorAll(".tab")].forEach(a => a.setAttribute("aria-current", a.dataset.cat===CAT ? "true" : "false"));
}

function shareURL(urlEnc, title){
  const url = decodeURIComponent(urlEnc);
  if(navigator.share){
    navigator.share({title, url}).catch(()=>window.open("https://www.linkedin.com/sharing/share-offsite/?url="+encodeURIComponent(url), "_blank"));
  }else{
    window.open("https://www.linkedin.com/sharing/share-offsite/?url="+encodeURIComponent(url), "_blank");
  }
}

async function loadData(){
  try{
    const r = await fetch("data/news.json?ts="+Date.now());
    if(!r.ok) throw new Error("news.json not found");
    const data = await r.json();
    ALL = Array.isArray(data.items) ? data.items : data;
    BUILD_AT = data.generated_at || null;
    UPDATED_EL.textContent = "Updated — " + (data.generated_at || new Date().toLocaleString());
    render();
  }catch(e){
    UPDATED_EL.textContent = "Updated —";
    FEED_EL.innerHTML = `
      <article class="item">
        <div class="media">
          <div></div>
          <div>
            <h3>News feed unavailable</h3>
            <div class="dek">Couldn’t load <code>data/news.json</code>. The site rebuilds every 3 hours.</div>
            <div class="meta">PTD Today</div>
          </div>
        </div>
      </article>`;
  }
}

TABS.addEventListener("click", e=>{
  const a = e.target.closest("a.tab"); if(!a) return;
  e.preventDefault(); CAT = a.dataset.cat; render();
});
document.getElementById("refresh").onclick = loadData;

loadData();
</script>
</body>
</html>
