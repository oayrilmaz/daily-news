<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PTD Today — Daily Energy & Power News</title>

<!-- Social cards -->
<meta property="og:title" content="PTD Today — Daily Energy & Power News">
<meta property="og:description" content="First to Know. First to Lead.">
<meta property="og:image" content="https://ptdtoday.com/assets/og-default.png">
<meta name="twitter:card" content="summary_large_image">

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' rx='42' fill='%23d9cfbc'/%3E%3Ctext x='50%' y='58%' font-family='Georgia,serif' font-size='128' text-anchor='middle' fill='%23331'%3EPTD%3C/text%3E%3C/svg%3E">

<style>
  :root{
    --bg:#e8dfcf; --ink:#231f1a; --muted:#6b6054;
    --frame:#d8cdbb; --pill:#efe6d6; --white:#fff;
    --link:#0b2c8a;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink)}
  body{font-family:Georgia,serif;line-height:1.5}
  .wrap{max-width:920px;margin:0 auto;padding:16px 14px 48px}
  h1{font-size:56px;margin:24px 0 0}
  .tag{margin:6px 0 22px;color:var(--muted);font-style:italic}
  h2{margin:6px 0 18px;font-size:26px}
  .tabs{display:flex;flex-wrap:wrap;gap:10px;margin:14px 0 8px}
  .tab{border-radius:999px;background:var(--pill);border:1px solid var(--frame);
       padding:8px 14px;font-weight:700;cursor:pointer}
  .tab.active{background:var(--white)}
  .stamp{display:inline-block;margin:12px 0 16px;background:var(--white);
         border-radius:999px;border:1px solid var(--frame);padding:8px 14px;color:var(--muted);
         font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .list{margin:8px 0}
  .card{display:grid;grid-template-columns:120px 1fr;gap:16px;background:var(--white);
        border:1px solid var(--frame);border-radius:8px;padding:14px;margin:18px 0}
  .thumb{width:120px;height:90px;object-fit:cover;border-radius:6px;background:#f0eadf;border:1px solid #e5dac7}
  .cat{font-size:12px;letter-spacing:.12em;color:var(--muted);text-transform:uppercase;margin-bottom:6px}
  .title{font-size:26px;line-height:1.25;margin:0}
  .title a{color:var(--link);text-decoration:none}
  .meta{color:var(--muted);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;font-size:14px;margin-top:6px}
  .btns{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
  .btn{border-radius:999px;padding:8px 14px;border:1px solid var(--frame);background:var(--white);cursor:pointer}
  footer{margin-top:28px}
</style>
</head>
<body>
<div class="wrap">
  <h1>PTD Today</h1>
  <div class="tag">First to Know. First to Lead.</div>
  <h2>Daily Energy &amp; Power News</h2>

  <nav class="tabs" id="tabs">
    <button class="tab active" data-cat="all">All</button>
    <button class="tab" data-cat="top">Top (7d)</button>
    <button class="tab" data-cat="grid">Grid</button>
    <button class="tab" data-cat="substations">Substations</button>
    <button class="tab" data-cat="protection">Protection</button>
    <button class="tab" data-cat="cables">Cables</button>
    <button class="tab" data-cat="hvdc">HVDC</button>
    <button class="tab" data-cat="renewables">Renewables</button>
    <button class="tab" data-cat="policy">Policy</button>
    <button class="tab" data-cat="ai">AI</button>
    <button class="tab" data-cat="datacenters">Data Centers</button>
  </nav>

  <div class="stamp" id="stamp">Updated — …</div>
  <main id="list" class="list" aria-live="polite"></main>

  <footer class="meta">© 2025 PTD Today • Headlines link to their original publishers.</footer>
</div>

<script>
const STAMP = document.getElementById('stamp');
const LIST  = document.getElementById('list');
const TABS  = document.getElementById('tabs');

const DAY = 24*60*60*1000;
const PLACEHOLDER = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='120'%3E%3Crect width='100%25' height='100%25' fill='%23efe7d7'/%3E%3Cpath d='M15 90 L60 50 L85 72 L110 58 L145 90 Z' fill='%23d7c9b1'/%3E%3C/svg%3E";

function windows(now=new Date()){
  const d = new Date(Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()));
  const dow = d.getUTCDay(); // 0 Sun..6 Sat
  let allFrom;
  if(dow===1){ allFrom = new Date(d.getTime()-3*DAY); }        // Mon => Fri..Mon
  else if(dow===0){ allFrom = new Date(d.getTime()-2*DAY); }   // Sun => Fri..Sun
  else { allFrom = new Date(d.getTime()-1*DAY); }              // others => yesterday..now
  return { all:[allFrom, now], top:[new Date(now.getTime()-7*DAY), now] };
}
function inWin(win, iso){ const t=new Date(iso); return t>=win[0] && t<=win[1]; }

function makeCard(it){
  const a = document.createElement('article');
  a.className = 'card';
  const short = `https://ptdtoday.com/s/${it.id}.html`;
  a.innerHTML = `
    <img class="thumb" src="${it.image||PLACEHOLDER}" alt="">
    <div>
      <div class="cat">${(it.category||'').toUpperCase()}</div>
      <h3 class="title"><a href="${short}">${it.title}</a></h3>
      <div class="meta">${(it.source||'')}${it.source?' • ':''}${new Date(it.published).toISOString().replace('.000Z','Z')}${it.score!=null?' • Score: '+(+it.score).toFixed(3):''}</div>
      <div class="btns">
        <a class="btn" href="${short}">Open on PTD Today</a>
        <a class="btn" href="${it.url}" rel="nofollow">Source</a>
        <button class="btn" onclick="sharePTD('${short}','${it.title.replace(/'/g,'’')}')">Share</button>
      </div>
    </div>`;
  // hard fallback if the remote image 404s:
  a.querySelector('.thumb').onerror = function(){ this.onerror=null; this.src=PLACEHOLDER; };
  return a;
}

function render(cat, items){
  const now = new Date();
  const win = windows(now);
  let rows = items.slice();

  if(cat==='top') rows = rows.filter(it=>inWin(win.top,it.published));
  else if(cat==='all') rows = rows.filter(it=>inWin(win.all,it.published));
  else rows = rows.filter(it=>{
    const want = (cat||'').toLowerCase();
    const hit  = (it.category||'').toLowerCase()===want;
    return hit && (inWin(win.all,it.published) || inWin(win.top,it.published));
  });

  LIST.innerHTML = '';
  if(rows.length===0){
    const p=document.createElement('p'); p.className='meta'; p.textContent='No stories found.';
    LIST.appendChild(p); return;
  }
  rows.forEach(it=>LIST.appendChild(makeCard(it)));
}

function sharePTD(url,title){
  if(navigator.share){ navigator.share({title,url}).catch(()=>{}); }
  else { navigator.clipboard.writeText(url); alert('Link copied: '+url); }
}

(async function init(){
  const res = await fetch('/data/news.json',{cache:'no-store'});
  const data = await res.json();
  STAMP.textContent = 'Updated — ' + (data.updated||'');
  const items = (data.items||[]).slice().sort((a,b)=>new Date(b.published)-new Date(a.published));

  render('all', items);

  TABS.addEventListener('click', ev=>{
    const btn = ev.target.closest('.tab'); if(!btn) return;
    TABS.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t===btn));
    render(btn.dataset.cat, items);
  });
})();
</script>
</body>
</html>