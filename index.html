<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PTD Today — Daily Energy & Power News</title>
<link rel="stylesheet" href="assets/main.css">
<meta name="description" content="Curated, fast headlines for grid, substations, protection & control, cables, HVDC, renewables, and policy. First to Know. First to Lead.">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E⚡%3C/text%3E%3C/svg%3E">

<body>
<div class="wrap">
  <header>
    <h1>PTD Today</h1>
    <div class="tagline">First to Know. First to Lead.</div>
    <div class="kicker">Daily Energy &amp; Power News</div>
  </header>

  <nav id="tabs"></nav>
  <div id="updated" class="updated">Updated — …</div>
  <div id="list"></div>

  <footer>© 2025 PTD Today • Headlines link to their original publishers.</footer>
</div>

<!-- Share modal -->
<div class="dialog" id="shareDialog" role="dialog" aria-modal="true" aria-label="Share">
  <div class="box">
    <h3>Share</h3>
    <div class="list">
      <button data-sh="linkedin">LinkedIn</button>
      <button data-sh="x">X (Twitter)</button>
      <button data-sh="facebook">Facebook</button>
      <button data-sh="reddit">Reddit</button>
      <button data-sh="copy">Copy link</button>
      <button data-sh="email">Email</button>
    </div>
    <div class="copyHint" id="copyHint" hidden>Link copied ✔</div>
    <div class="close" id="closeShare">Close ×</div>
  </div>
</div>

<script>
const CATS = ["All","Top (7d)","Grid","Substations","Protection","Cables","HVDC","Renewables","Policy"];
const listEl = document.getElementById('list');
const tabsEl = document.getElementById('tabs');
const updatedEl = document.getElementById('updated');
let ITEMS=[], CAT="All";

function tab(a){return `<a href="#" data-cat="${a}">${a}</a>`}
tabsEl.innerHTML = CATS.map(tab).join('');
tabsEl.addEventListener('click', e=>{
  const a=e.target.closest('a'); if(!a) return;
  e.preventDefault(); CAT=a.dataset.cat; render();
});

fetch('data/news.json?_='+Date.now()).then(r=>r.json()).then(data=>{
  ITEMS = data.items||[];
  updatedEl.textContent = 'Updated — ' + (data.updated||'');
  CAT = (new URL(location).searchParams.get('cat')||'All');
  render();
});

function score7d(it){ // simplistic "top" filter by score/date
  const t=Date.parse(it.iso||it.date||''); return (Date.now()-t) < 7*864e5;
}
function matchCat(it){
  if(CAT==='All') return true;
  if(CAT==='Top (7d)') return score7d(it);
  return (it.category||'').toLowerCase()===CAT.toLowerCase();
}
function esc(s){return s?String(s).replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m])):''}

function render(){
  [...tabsEl.querySelectorAll('a')].forEach(a=>a.classList.toggle('active',a.dataset.cat===CAT));
  const out = ITEMS.filter(matchCat).map(it=>`
    <article class="item">
      <img class="thumb" src="${esc(it.image||'')}" alt="">
      <div>
        <h2><a href="${esc(it.url)}" target="_blank" rel="noopener">${esc(it.title)}</a></h2>
        <div class="meta">${esc(it.category||'')} • ${esc(it.source||'')} • ${esc(it.date||'')}</div>
        <div class="links">
          <a class="btn primary" href="${esc(it.url)}" target="_blank" rel="noopener">Open on PTD Today</a>
          <a class="btn" href="${esc(it.original)}" target="_blank" rel="noopener">Source</a>
          <button class="btn" data-share="${esc(it.url)}" data-title="${esc(it.title)}">Share</button>
        </div>
      </div>
    </article>
  `).join('');
  listEl.innerHTML = out || `<p>No stories in this category yet.</p>`;
}
</script>

<script>
/* Share logic (Chooser + Web Share) */
const dlg = document.getElementById('shareDialog');
const closeShare = document.getElementById('closeShare');
const copyHint = document.getElementById('copyHint');
let shareTarget={url:'', title:''};

document.addEventListener('click', e=>{
  const b = e.target.closest('[data-share]');
  if(b){
    shareTarget.url=b.dataset.share;
    shareTarget.title=b.dataset.title||'';
    if(navigator.share){
      navigator.share({title:shareTarget.title, url:shareTarget.url}).catch(()=>{});
    }else{
      dlg.style.display='grid';
      copyHint.hidden=true;
    }
  }
});
closeShare.onclick = ()=>{ dlg.style.display='none'; }

dlg.addEventListener('click', e=>{
  const btn = e.target.closest('[data-sh]'); if(!btn) return;
  const u = encodeURIComponent(shareTarget.url);
  const t = encodeURIComponent(shareTarget.title);
  const open = href => { window.open(href,'_blank'); };
  switch(btn.dataset.sh){
    case 'linkedin': open(`https://www.linkedin.com/sharing/share-offsite/?url=${u}`); break;
    case 'x': open(`https://twitter.com/intent/tweet?url=${u}&text=${t}`); break;
    case 'facebook': open(`https://www.facebook.com/sharer/sharer.php?u=${u}`); break;
    case 'reddit': open(`https://www.reddit.com/submit?url=${u}&title=${t}`); break;
    case 'email': location.href=`mailto:?subject=${t}&body=${u}`; break;
    case 'copy':
      navigator.clipboard.writeText(shareTarget.url).then(()=>{copyHint.hidden=false;});
      break;
  }
});
</script>
</body>
</html>